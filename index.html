<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formulário para Visto Americano</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 20px auto;
            padding: 20px;
            background-color: #f4f7f6; /* Cor de fundo suave */
            box-shadow: 0 0 15px rgba(0,0,0,0.1); /* Sombra para profundidade */
            border-radius: 8px; /* Cantos arredondados */
        }
        h1 {
            color: #003087; /* Azul escuro, como a bandeira americana */
            text-align: center;
            margin-bottom: 20px;
        }
        h3 {
            color: #C8102E; /* Vermelho, como a bandeira americana */
            border-bottom: 2px solid #eee; /* Linha sutil abaixo dos títulos */
            padding-bottom: 8px;
            margin-top: 30px;
            font-size: 1.2em;
        }
        h4 {
            color: #333;
            margin-top: 20px;
            margin-bottom: 10px;
            font-size: 1.1em;
            border-bottom: 1px dashed #ccc; /* Linha tracejada para sub-títulos */
            padding-bottom: 5px;
        }
        label {
            display: block;
            margin: 15px 0 5px; /* Espaçamento maior para labels */
            font-weight: bold;
            color: #333;
        }
        input[type="text"],
        input[type="date"],
        input[type="tel"],
        input[type="email"],
        input[type="number"],
        select,
        textarea {
            width: calc(100% - 20px); /* Ajuste para padding */
            padding: 10px;
            margin-bottom: 15px; /* Mais espaço abaixo dos campos */
            border: 1px solid #ccc;
            border-radius: 5px;
            box-sizing: border-box; /* Garante que padding e border não aumentem a largura */
            font-size: 1em;
        }
        textarea {
            resize: vertical; /* Permite redimensionar verticalmente */
            min-height: 60px;
        }
        button {
            background-color: #25D366; /* Cor de WhatsApp */
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1.1em;
            margin-top: 30px;
            display: block;
            width: 100%; /* Botão em largura total */
            transition: background-color 0.3s ease; /* Transição suave no hover */
        }
        button:hover {
            background-color: #20b354;
        }
        /* Estilos para as seções condicionais (mantidos do seu original, mas aprimorados visualmente) */
        #spouseInfo, #spouseDeathInfo, #parentsInfo, #previousUSVisaInfo, #travelCompanionsInfo, #visaDeniedDetails, #payerInfo, #payerAddressInfo, #renewalInfo, #parentsInUSInfo, #acquaintancesInfo {
            display: none;
            margin-top: 20px;
            padding: 20px;
            border: 1px dashed #a0a0a0; /* Borda tracejada para destacar */
            border-radius: 8px;
            background-color: #f9f9f9; /* Fundo leve para seções condicionais */
        }
        hr {
            margin: 40px 0; /* Mais espaço para as divisórias */
            border: 0;
            border-top: 2px solid #003087; /* Linha divisória mais proeminente */
        }
        p strong {
            color: #C8102E; /* Destaca o texto "Declaro estar ciente de:" */
        }
        ol {
            margin-left: 25px;
            color: #555;
            line-height: 1.6; /* Melhor legibilidade para listas */
        }
        ol li {
            margin-bottom: 8px; /* Espaço entre itens da lista */
        }
        #aceiteDeclaracao {
            width: auto; /* Checkbox não ocupa 100% */
            margin-left: 10px;
            vertical-align: middle; /* Alinha com o texto */
        }
    </style>
</head>
<body>
    <h1>Formulário para Visto Americano</h1>
    <p>Preencha os dados abaixo. Ao clicar em "Enviar", um PDF detalhado será gerado, baixado automaticamente e uma mensagem será enviada ao WhatsApp com os dados básicos e um link para o PDF.</p>

    <form id="visaForm" name="visaForm" method="POST">
        <h3>Informações Pessoais</h3>
        <label for="nome">Nome completo (como no passaporte):</label>
        <input type="text" id="nome" name="nome" required>

        <label for="sobrenome">Sobrenome (como no passaporte):</label>
        <input type="text" id="sobrenome" name="sobrenome" required>

        <label for="outrosNomes">Já usou outros nomes? (ex.: nome de solteiro, apelido):</label>
        <input type="text" id="outrosNomes" name="outrosNomes">

        <label for="cpf">CPF:</label>
        <input type="text" id="cpf" name="cpf" maxlength="14" oninput="formatCPF(this)">

        <label for="nascimento">Data de nascimento:</label>
        <input type="date" id="nascimento" name="nascimento" required>

        <label for="localNascimento">Cidade e país de nascimento:</label>
        <input type="text" id="localNascimento" name="localNascimento" required>

        <label for="sexo">Sexo:</label>
        <select id="sexo" name="sexo" required>
            <option value="">Selecione</option>
            <option value="Masculino">Masculino</option>
            <option value="Feminino">Feminino</option>
            <option value="Outro">Outro</option>
        </select>

        <label for="estadoCivil">Estado civil:</label>
        <select id="estadoCivil" name="estadoCivil" required>
            <option value="">Selecione</option>
            <option value="Solteiro">Solteiro</option>
            <option value="Casado">Casado</option>
            <option value="Divorciado">Divorciado</option>
            <option value="Viúvo">Viúvo</option>
            <option value="União Estável">União Estável</option>
        </select>

        <div id="spouseInfo">
            <h4>Dados do Cônjuge</h4>
            <label for="spouseNome">Nome completo do cônjuge:</label>
            <input type="text" id="spouseNome" name="spouseNome">

            <label for="spouseNascimento">Data de nascimento do cônjuge:</label>
            <input type="date" id="spouseNascimento" name="spouseNascimento">

            <label for="spouseLocalNascimento">Cidade e país de nascimento do cônjuge:</label>
            <input type="text" id="spouseLocalNascimento" name="spouseLocalNascimento">

            <div id="spouseDeathInfo">
                <label for="spouseFalecimento">Data de falecimento do cônjuge:</label>
                <input type="date" id="spouseFalecimento" name="spouseFalecimento">
            </div>
        </div>
        <hr>

        <label for="nacionalidade">Nacionalidade atual:</label>
        <input type="text" id="nacionalidade" name="nacionalidade" required>

        <label for="outrasNacionalidades">Possui outras nacionalidades? (Se sim, quais?):</label>
        <input type="text" id="outrasNacionalidades" name="outrasNacionalidades">

        <label for="passaporte">Número do passaporte:</label>
        <input type="text" id="passaporte" name="passaporte" required>

        <label for="dataEmissaoPassaporte">Data de emissão do passaporte:</label>
        <input type="date" id="dataEmissaoPassaporte" name="dataEmissaoPassaporte" required>

        <label for="dataValidadePassaporte">Data de validade do passaporte:</label>
        <input type="date" id="dataValidadePassaporte" name="dataValidadePassaporte" required>

        <label for="localEmissaoPassaporte">Local de emissão do passaporte:</label>
        <input type="text" id="localEmissaoPassaporte" name="localEmissaoPassaporte" required>

        <h3>Informações de Contato</h3>
        <label for="cep">CEP (ex.: 70.340-902):</label>
        <input type="text" id="cep" name="cep" maxlength="10" oninput="formatCEP(this)" required>

        <label for="endereco">Endereço completo (rua, número, bairro):</label>
        <textarea id="endereco" name="endereco" required></textarea>

        <label for="cidade">Cidade:</label>
        <input type="text" id="cidade" name="cidade" required>

        <label for="estado">Estado/Província:</label>
        <input type="text" id="estado" name="estado" required>

        <label for="pais">País:</label>
        <input type="text" id="pais" name="pais" required>

        <label for="telefone">Número de telefone (com código do país):</label>
        <input type="tel" id="telefone" name="telefone" required>

        <label for="email">E-mail:</label>
        <input type="email" id="email" name="email" required>

        <h3>Informações Familiares</h3>
        <label for="temPaisVivos">Seus pais estão vivos?</label>
        <select id="temPaisVivos" name="temPaisVivos" required>
            <option value="">Selecione</option>
            <option value="Sim">Sim</option>
            <option value="Não">Não</option>
        </select>

        <div id="parentsInfo">
            <label for="nomePai">Nome completo do pai:</label>
            <input type="text" id="nomePai" name="nomePai">

            <label for="nascimentoPai">Data de nascimento do pai:</label>
            <input type="date" id="nascimentoPai" name="nascimentoPai">

            <label for="nomeMae">Nome completo da mãe:</label>
            <input type="text" id="nomeMae" name="nomeMae">

            <label for="nascimentoMae">Data de nascimento da mãe:</label>
            <input type="date" id="nascimentoMae" name="nascimentoMae">

            <label for="paisNosEUA">Seus pais estão nos EUA?</label>
            <select id="paisNosEUA" name="paisNosEUA">
                <option value="">Selecione</option>
                <option value="Sim">Sim</option>
                <option value="Não">Não</option>
            </select>

            <div id="parentsInUSInfo">
                <label for="explicacaoPaisEUA">Explique a situação dos seus pais nos EUA:</label>
                <textarea id="explicacaoPaisEUA" name="explicacaoPaisEUA"></textarea>
            </div>
        </div>

        <label for="temConhecidosEUA">Tem conhecidos nos EUA?</label>
        <select id="temConhecidosEUA" name="temConhecidosEUA" required>
            <option value="">Selecione</option>
            <option value="Sim">Sim</option>
            <option value="Não">Não</option>
        </select>

        <div id="acquaintancesInfo">
            <h4>Dados do Conhecido nos EUA</h4>
            <label for="nomeConhecido">Nome completo do conhecido:</label>
            <input type="text" id="nomeConhecido" name="nomeConhecido">

            <label for="telefoneConhecido">Telefone do conhecido (com código do país):</label>
            <input type="tel" id="telefoneConhecido" name="telefoneConhecido">

            <label for="emailConhecido">E-mail do conhecido:</label>
            <input type="email" id="emailConhecido" name="emailConhecido">

            <label for="vinculoConhecido">Vínculo com o solicitante (ex.: amigo, parente):</label>
            <input type="text" id="vinculoConhecido" name="vinculoConhecido">
        </div>

        <h3>Detalhes da Viagem</h3>
        <label for="objetivo">Objetivo da viagem aos EUA:</label>
        <select id="objetivo" name="objetivo" required>
            <option value="">Selecione</option>
            <option value="Turismo">Turismo</option>
            <option value="Negócios">Negócios</option>
            <option value="Estudo">Estudo</option>
            <option value="Trabalho">Trabalho</option>
            <option value="Visita a Familiares">Visita a Familiares</option>
            <option value="Outro">Outro</option>
        </select>

        <label for="chegada">Data prevista de chegada aos EUA:</label>
        <input type="date" id="chegada" name="chegada" required>

        <label for="tempo">Quanto tempo pretende ficar nos EUA? (ex.: 2 semanas, 6 meses):</label>
        <input type="text" id="tempo" name="tempo" required>

        <label for="enderecoEUA">Endereço onde ficará nos EUA (rua, cidade, estado, CEP):</label>
        <textarea id="enderecoEUA" name="enderecoEUA" placeholder="Digite o endereço, se disponível (Não obrigatório)"></textarea>

        <label for="quemPaga">Quem está pagando pela viagem?</label>
        <select id="quemPaga" name="quemPaga" required>
            <option value="">Selecione</option>
            <option value="Eu mesmo">Eu mesmo</option>
            <option value="Outra pessoa">Outra pessoa</option>
        </select>

        <div id="payerInfo">
            <h4>Dados da Pessoa Pagante</h4>
            <label for="payerNome">Nome completo da pessoa pagante:</label>
            <input type="text" id="payerNome" name="payerNome">

            <label for="payerSameAddress">O endereço é o mesmo do solicitante?</label>
            <select id="payerSameAddress" name="payerSameAddress">
                <option value="">Selecione</option>
                <option value="Sim">Sim</option>
                <option value="Não">Não</option>
            </select>

            <div id="payerAddressInfo">
                <label for="payerCEP">CEP (ex.: 70.340-902):</label>
                <input type="text" id="payerCEP" name="payerCEP" maxlength="10" oninput="formatCEP(this)">

                <label for="payerEndereco">Endereço completo (rua, número, bairro):</label>
                <textarea id="payerEndereco" name="payerEndereco"></textarea>

                <label for="payerCidade">Cidade:</label>
                <input type="text" id="payerCidade" name="payerCidade">

                <label for="payerEstado">Estado/Província:</label>
                <input type="text" id="payerEstado" name="payerEstado">

                <label for="payerPais">País:</label>
                <input type="text" id="payerPais" name="payerPais">
            </div>

            <label for="payerEmail">E-mail da pessoa pagante:</label>
            <input type="email" id="payerEmail" name="payerEmail">

            <label for="payerTelefone">Telefone da pessoa pagante (com código do país):</label>
            <input type="tel" id="payerTelefone" name="payerTelefone">

            <label for="payerVinculo">Vínculo com o solicitante (ex.: pai, amigo, empregador):</label>
            <input type="text" id="payerVinculo" name="payerVinculo">
        </div>

        <label for="temCompanheiros">Vai viajar com alguém?</label>
        <select id="temCompanheiros" name="temCompanheiros" required>
            <option value="">Selecione</option>
            <option value="Sim">Sim</option>
            <option value="Não">Não</option>
        </select>

        <div id="travelCompanionsInfo">
            <label for="nomeCompanheiro">Nome completo do(s) companheiro(s) de viagem:</label>
            <textarea id="nomeCompanheiro" name="nomeCompanheiro"></textarea>

            <label for="relacaoCompanheiro">Relação com o(s) companheiro(s) (ex.: amigo, colega):</label>
            <input type="text" id="relacaoCompanheiro" name="relacaoCompanheiro">
        </div>

        <h3>Informações de Trabalho</h3>
        <label for="ocupacao">Ocupação atual:</label>
        <input type="text" id="ocupacao" name="ocupacao" required>

        <label for="empregador">Nome do empregador:</label>
        <input type="text" id="empregador" name="empregador" required>

        <label for="enderecoEmpregador">Endereço do empregador:</label>
        <textarea id="enderecoEmpregador" name="enderecoEmpregador" required></textarea>

        <label for="telefoneEmpregador">Telefone do empregador:</label>
        <input type="tel" id="telefoneEmpregador" name="telefoneEmpregador" required>

        <label for="dataInicioTrabalho">Data de início no emprego:</label>
        <input type="date" id="dataInicioTrabalho" name="dataInicioTrabalho" required>

        <label for="rendaMensal">Renda mensal (em reais):</label>
        <input type="text" id="rendaMensal" name="rendaMensal" required>

        <h3>Informações de Educação</h3>
        <label for="nivelEducacao">Nível mais alto de educação concluído:</label>
        <select id="nivelEducacao" name="nivelEducacao" required>
            <option value="">Selecione</option>
            <option value="Ensino Fundamental">Ensino Fundamental</option>
            <option value="Ensino Médio">Ensino Médio</option>
            <option value="Ensino Superior">Ensino Superior</option>
            <option value="Pós-Graduação">Pós-Graduação</option>
        </select>

        <label for="instituicao">Nome da instituição educacional:</label>
        <input type="text" id="instituicao" name="instituicao" required>

        <label for="enderecoInstituicao">Endereço da instituição:</label>
        <textarea id="enderecoInstituicao" name="enderecoInstituicao" required></textarea>

        <label for="dataInicioEducacao">Data de início do curso:</label>
        <input type="date" id="dataInicioEducacao" name="dataInicioEducacao" required>

        <label for="dataFimEducacao">Data de conclusão do curso:</label>
        <input type="date" id="dataFimEducacao" name="dataFimEducacao" required>

        <h3>Histórico de Viagens</h3>
        <label for="primeiroVisto">É o seu primeiro visto ou uma renovação?</label>
        <select id="primeiroVisto" name="primeiroVisto" required>
            <option value="">Selecione</option>
            <option value="Primeiro visto">Primeiro visto</option>
            <option value="Renovação">Renovação</option>
        </select>

        <div id="renewalInfo">
            <label for="numeroVistoAnteriorRenovacao">Número do visto anterior:</label>
            <input type="text" id="numeroVistoAnteriorRenovacao" name="numeroVistoAnteriorRenovacao">

            <label for="dataEmissaoVistoAnterior">Data de emissão do visto anterior:</label>
            <input type="date" id="dataEmissaoVistoAnterior" name="dataEmissaoVistoAnterior">

            <label for="dataValidadeVistoAnterior">Data de validade do visto anterior:</label>
            <input type="date" id="dataValidadeVistoAnterior" name="dataValidadeVistoAnterior">

            <label for="localEmissaoVistoAnterior">Local de emissão do visto anterior:</label>
            <input type="text" id="localEmissaoVistoAnterior" name="localEmissaoVistoAnterior">
        </div>

        <label for="visitouEUA">Já visitou os EUA antes?</label>
        <select id="visitouEUA" name="visitouEUA" required>
            <option value="">Selecione</option>
            <option value="Sim">Sim</option>
            <option value="Não">Não</option>
        </select>

        <label for="impressaoDigital">Já teve impressão digital dos dedos coletada?</label>
        <select id="impressaoDigital" name="impressaoDigital" required>
            <option value="">Selecione</option>
            <option value="Sim">Sim</option>
            <option value="Não">Não</option>
        </select>

        <div id="previousUSVisaInfo">
            <label for="dataUltimaVisita">Data da última visita aos EUA:</label>
            <input type="date" id="dataUltimaVisita" name="dataUltimaVisita">

            <label for="tempoUltimaVisita">Tempo de estadia na última visita:</label>
            <input type="text" id="tempoUltimaVisita" name="tempoUltimaVisita">

            <label for="numeroVistoAnterior">Número do visto anterior (se aplicável):</label>
            <input type="text" id="numeroVistoAnterior" name="numeroVistoAnterior">
        </div>

        <label for="outrosPaises">Países visitados nos últimos 5 anos:</label>
        <textarea id="outrosPaises" name="outrosPaises"></textarea>

        <label for="vistoNegado">Já teve um visto americano negado?</label>
        <select id="vistoNegado" name="vistoNegado" required>
            <option value="">Selecione</option>
            <option value="Sim">Sim</option>
            <option value="Não">Não</option>
        </select>

        <label for="entradaRecusada">Já foi negada admissão aos EUA ou teve entrada recusada?</label>
        <select id="entradaRecusada" name="entradaRecusada" required>
            <option value="">Selecione</option>
            <option value="Sim">Sim</option>
            <option value="Não">Não</option>
        </select>

        <div id="visaDeniedDetails">
            <label for="detalhesVistoNegado">Detalhes da negativa (data e motivo):</label>
            <textarea id="detalhesVistoNegado" name="detalhesVistoNegado"></textarea>
        </div>

        <h3>Declaração</h3>
        <p>Eu, <input type="text" id="declaracaoNome" name="declaracaoNome" placeholder="Nome completo" required>, declaro, sob as penas da lei, que li e compreendi integralmente todas as questões contidas nesta solicitação de visto e afirmo que as respostas por mim fornecidas são verdadeiras, completas e corretas, conforme o meu melhor conhecimento e convicção.</p>

        <p><strong>Declaro estar ciente de que:</strong></p>
        <ol>
            <li>Qualquer declaração falsa, incompleta ou enganosa poderá resultar na recusa permanente do visto ou na negativa de admissão nos Estados Unidos, conforme disposto na legislação aplicável.</li>
            <li>Todas as informações prestadas nesta solicitação constituem declarações juramentadas, realizadas sob pena de perjúrio, nos termos do disposto no <em>28 U.S.C. § 1746</em>.</li>
            <li>Informações adicionais poderão ser requisitadas pelas autoridades competentes após a análise desta solicitação, sendo minha responsabilidade fornecê-las tempestivamente.</li>
            <li>As informações contidas nesta solicitação poderão ser compartilhadas com outras agências governamentais dos Estados Unidos, que possuem autoridade para utilizá-las para fins de aplicação da lei ou para propósitos imigratórios, conforme permitido pela legislação vigente.</li>
            <li>A fotografia fornecida com esta solicitação poderá ser utilizada pelas autoridades americanas para fins de verificação de identidade, empregabilidade ou outros objetivos legais previstos na legislação dos Estados Unidos.</li>
        </ol>

        <p><strong>Declaro ainda:</strong></p>
        <ol start="6">
            <li>Que sou exclusivamente responsável pela autenticidade e exatidão dos documentos apresentados e das informações prestadas nesta solicitação.</li>
            <li>Que tenho pleno conhecimento de que a concessão ou negativa do visto é prerrogativa exclusiva da Autoridade Consular Americana, não cabendo a terceiros qualquer ingerência sobre tal decisão.</li>
            <li>Que estou ciente de que, em processos de renovação de visto, entrevistas presenciais poderão ser exigidas a critério exclusivo da Autoridade Consular Americana.</li>
            <li>Que reconheço que o serviço contratado constitui assessoria relacionada ao processo de preenchimento de documentação, agendamento de biometria e entrevista, não abrangendo serviços de entrega ou retirada de documentos no Centro de Atendimento ao Solicitante de Visto (CASV), sendo necessária a contratação de um agente colaborador, caso eu deseje tais serviços adicionais.</li>
            <li>Que a aposição de minha assinatura eletrônica neste documento possui validade jurídica, conforme a legislação aplicável, e representa meu reconhecimento expresso dos serviços contratados.</li>
        </ol>

        <p><strong>Autorização:</strong></p>
        <p>Declaro, por fim, ter revisado e conferido todos os dados por mim apresentados, autorizando expressamente a empresa <strong>Objetivo Turismo Ltda.</strong>, contratada diretamente por mim ou por intermédio de minha agência, a proceder com o envio eletrônico do Formulário DS-160 ao Consulado Americano, bem como a realizar o pagamento das taxas e o agendamento necessários à tramitação do meu pedido de visto.</p>

        <label for="declaracaoLocal">Local:</label>
        <input type="text" id="declaracaoLocal" name="declaracaoLocal" required>

        <label for="declaracaoData">Data:</label>
        <input type="date" id="declaracaoData" name="declaracaoData" required>

        <label>Concordo com os termos desta declaração <input type="checkbox" id="aceiteDeclaracao" name="aceiteDeclaracao" required style="width: auto; margin-left: 10px;"></label>

        <button type="submit">Enviar Formulário</button>
    </form>

    <script type="module">
        // Importa as funções necessárias do Firebase SDK
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.5.0/firebase-app.js";
        import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/11.5.0/firebase-storage.js";
        // import { getAnalytics } from "https://www.gstatic.com/firebasejs/11.5.0/firebase-analytics.js"; // Opcional, remova se não usar

        // Configuração do Firebase com suas credenciais (A MESMA API KEY FORNECIDA)
        const firebaseConfig = {
            apiKey: "AIzaSyAkBV0rHEghBOHl2mDOs6rMDHkUgYMxFr0", // Sua API Key real
            authDomain: "visaformulariostorage.firebaseapp.com",
            projectId: "visaformulariostorage",
            storageBucket: "visaformulariostorage.firebasestorage.app",
            messagingSenderId: "720170394408",
            appId: "1:720170394408:web:b1c294c39c489388f6261d",
            measurementId: "G-ZFCV4JEEFT"
        };

        // Inicializa o Firebase
        const app = initializeApp(firebaseConfig);
        const storage = getStorage(app);
        // const analytics = getAnalytics(app); // Opcional

        // --- Funções de Formatação de CPF e CEP (MANTIDAS COMO VOCÊ AS FORNECEU) ---
        window.formatCPF = function(input) {
            let value = input.value.replace(/\D/g, ''); // Remove tudo que não é número
            if (value.length > 11) value = value.slice(0, 11); // Limita a 11 dígitos
            value = value.replace(/(\d{3})(\d)/, '$1.$2'); // Adiciona o primeiro ponto
            value = value.replace(/(\d{3})(\d)/, '$1.$2'); // Adiciona o segundo ponto
            value = value.replace(/(\d{3})(\d{1,2})$/, '$1-$2'); // Adiciona o traço
            input.value = value;
        }

        window.formatCEP = function(input) {
            let value = input.value.replace(/\D/g, '');
            if (value.length > 8) value = value.slice(0, 8);
            if (value.length > 5) {
                value = value.replace(/(\d{2})(\d{3})(\d{3})/, '$1.$2-$3');
            } else if (value.length > 2) {
                value = value.replace(/(\d{2})(\d+)/, '$1.$2');
            }
            input.value = value;
        }

        // --- Funções Auxiliares para o Comportamento do FORMULÁRIO HTML (MANTIDAS COMO VOCÊ AS FORNECEU) ---
        function toggleSpouseInfo() {
            const estadoCivil = document.getElementById('estadoCivil');
            const spouseInfo = document.getElementById('spouseInfo');
            const spouseDeathInfo = document.getElementById('spouseDeathInfo');
            if (estadoCivil.value === 'Casado' || estadoCivil.value === 'Divorciado' || estadoCivil.value === 'Viúvo' || estadoCivil.value === 'União Estável') {
                spouseInfo.style.display = 'block';
                spouseDeathInfo.style.display = (estadoCivil.value === 'Viúvo') ? 'block' : 'none';
            } else {
                spouseInfo.style.display = 'none';
                spouseDeathInfo.style.display = 'none';
            }
        }

        function toggleParentsInfo() {
            const temPaisVivos = document.getElementById('temPaisVivos');
            const parentsInfo = document.getElementById('parentsInfo');
            parentsInfo.style.display = (temPaisVivos.value === 'Sim') ? 'block' : 'none';
        }

        function toggleParentsInUSInfo() {
            const paisNosEUA = document.getElementById('paisNosEUA');
            const parentsInUSInfo = document.getElementById('parentsInUSInfo');
            parentsInUSInfo.style.display = (paisNosEUA.value === 'Sim') ? 'block' : 'none';
        }

        function toggleTravelCompanionsInfo() {
            const temCompanheiros = document.getElementById('temCompanheiros');
            const travelCompanionsInfo = document.getElementById('travelCompanionsInfo');
            travelCompanionsInfo.style.display = (temCompanheiros.value === 'Sim') ? 'block' : 'none';
        }

        function togglePreviousUSVisaInfo() {
            const visitouEUA = document.getElementById('visitouEUA');
            const previousUSVisaInfo = document.getElementById('previousUSVisaInfo');
            previousUSVisaInfo.style.display = (visitouEUA.value === 'Sim') ? 'block' : 'none';
        }

        function toggleVisaDeniedDetails() {
            const vistoNegado = document.getElementById('vistoNegado');
            const entradaRecusada = document.getElementById('entradaRecusada');
            const visaDeniedDetails = document.getElementById('visaDeniedDetails');
            visaDeniedDetails.style.display = (vistoNegado.value === 'Sim' || entradaRecusada.value === 'Sim') ? 'block' : 'none';
        }

        function togglePayerInfo() {
            const quemPaga = document.getElementById('quemPaga');
            const payerInfo = document.getElementById('payerInfo');
            payerInfo.style.display = (quemPaga.value === 'Outra pessoa') ? 'block' : 'none';
        }

        function togglePayerAddressInfo() {
            const payerSameAddress = document.getElementById('payerSameAddress');
            const payerAddressInfo = document.getElementById('payerAddressInfo');
            payerAddressInfo.style.display = (payerSameAddress.value === 'Não') ? 'block' : 'none';
        }

        function toggleRenewalInfo() {
            const primeiroVisto = document.getElementById('primeiroVisto');
            const renewalInfo = document.getElementById('renewalInfo');
            renewalInfo.style.display = (primeiroVisto.value === 'Renovação') ? 'block' : 'none';
        }

        function toggleAcquaintancesInfo() {
            const temConhecidosEUA = document.getElementById('temConhecidosEUA');
            const acquaintancesInfo = document.getElementById('acquaintancesInfo');
            acquaintancesInfo.style.display = (temConhecidosEUA.value === 'Sim') ? 'block' : 'none';
        }

        function formatDateBr(dateStr) {
            if (!dateStr) return 'Não informado';
            try {
                const [year, month, day] = dateStr.split('-');
                const date = new Date(year, month - 1, day);
                if (isNaN(date.getTime())) {
                    return 'Data inválida';
                }
                return date.toLocaleDateString('pt-BR', { timeZone: 'America/Sao_Paulo' });
            } catch (e) {
                return 'Erro ao formatar data';
            }
        }

        // Adicionando event listeners (MANTIDOS COMO VOCÊ OS FORNECEU)
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('estadoCivil').addEventListener('change', toggleSpouseInfo);
            document.getElementById('temPaisVivos').addEventListener('change', toggleParentsInfo);
            document.getElementById('paisNosEUA').addEventListener('change', toggleParentsInUSInfo);
            document.getElementById('temConhecidosEUA').addEventListener('change', toggleAcquaintancesInfo);
            document.getElementById('quemPaga').addEventListener('change', togglePayerInfo);
            document.getElementById('payerSameAddress').addEventListener('change', togglePayerAddressInfo);
            document.getElementById('temCompanheiros').addEventListener('change', toggleTravelCompanionsInfo);
            document.getElementById('primeiroVisto').addEventListener('change', toggleRenewalInfo);
            document.getElementById('visitouEUA').addEventListener('change', togglePreviousUSVisaInfo);
            document.getElementById('vistoNegado').addEventListener('change', toggleVisaDeniedDetails);
            document.getElementById('entradaRecusada').addEventListener('change', toggleVisaDeniedDetails);
            document.getElementById('visaForm').addEventListener('submit', generatePDF);

            // Chamar as funções uma vez no carregamento para garantir o estado inicial correto
            toggleSpouseInfo();
            toggleParentsInfo();
            toggleParentsInUSInfo();
            toggleAcquaintancesInfo();
            togglePayerInfo();
            togglePayerAddressInfo();
            toggleTravelCompanionsInfo();
            toggleRenewalInfo();
            togglePreviousUSVisaInfo();
            toggleVisaDeniedDetails();
        });

        // Função para gerar o PDF (AQUI SÃO AS PRINCIPAIS MUDANÇAS DE LAYOUT E CONTEÚDO)
        async function generatePDF(event) {
            event.preventDefault();

            const submitButton = document.querySelector('button[type="submit"]');
            submitButton.disabled = true; // Desabilita o botão para evitar múltiplos envios

            try {
                const { jsPDF } = window.jspdf;
                const form = document.getElementById('visaForm');
                const formData = new FormData(form);

                const solicitanteNome = formData.get('nome') + ' ' + formData.get('sobrenome');
                const fixedWhatsAppNumber = '5561999998165'; // O número de WhatsApp da empresa

                const doc = new jsPDF();
                const pageWidth = doc.internal.pageSize.width;
                const pageHeight = doc.internal.pageSize.height;
                const margin = 15; // Margens aumentadas para um layout mais limpo
                let yPosition = 30;
                const lineHeight = 5;
                const sectionSpacing = 10; // Espaço maior entre seções
                const subSectionSpacing = 7; // Espaço para sub-seções

                // --- Funções de Desenho para o PDF ---
                function drawHeader() {
                    doc.setFillColor(0, 48, 135); // Azul escuro da bandeira
                    doc.rect(0, 0, pageWidth, 25, 'F');
                    doc.setFontSize(16);
                    doc.setTextColor(255, 255, 255);
                    doc.setFont("Helvetica", "bold");
                    const title = "Formulário de Solicitação de Visto Americano";
                    const titleWidth = doc.getTextWidth(title);
                    const titleX = (pageWidth - titleWidth) / 2;
                    doc.text(title, titleX, 15);
                    // Adicionando estrelas como no seu exemplo
                    doc.setFontSize(14);
                    const starSpacing = 8;
                    for (let i = 0; i < 3; i++) {
                        doc.text("*", titleX - (i + 1) * starSpacing - 5, 15);
                        doc.text("*", titleX + titleWidth + (i + 1) * starSpacing + 5, 15);
                    }
                }

                function drawPageBorder() {
                    doc.setDrawColor(0, 48, 135); // Borda azul escura
                    doc.setLineWidth(0.5);
                    doc.rect(margin / 2, margin / 2, pageWidth - margin, pageHeight - margin);
                }

                function addNewPageIfNeeded(requiredHeight = 20) {
                    if (yPosition + requiredHeight > pageHeight - margin) {
                        doc.addPage();
                        yPosition = 30; // Reset Y position for new page
                        drawHeader();
                        drawPageBorder();
                    }
                }

                function addSectionTitle(title) {
                    addNewPageIfNeeded(20); // Espaço para o título da seção
                    doc.setFillColor(200, 16, 46); // Vermelho da bandeira
                    doc.rect(margin, yPosition - 5, pageWidth - 2 * margin, 10, 'F');
                    doc.setFontSize(12);
                    doc.setTextColor(255, 255, 255);
                    doc.setFont("Helvetica", "bold");
                    doc.text(title, margin + 5, yPosition + 2);
                    yPosition += 15;
                    addSpacer(sectionSpacing);
                }
                
                function addSubSectionTitle(title) {
                    addNewPageIfNeeded(15);
                    doc.setFontSize(11);
                    doc.setTextColor(0, 0, 0); // Texto preto
                    doc.setFont("Helvetica", "bold");
                    doc.text(title, margin, yPosition);
                    yPosition += lineHeight + 2; // Pequeno espaço
                    addHorizontalLine(0.1, '#ccc'); // Linha mais fina e cinza para subseções
                    addSpacer(subSectionSpacing);
                }

                function addText(label, value, isBoldLabel = true, indent = 0) {
                    addNewPageIfNeeded(lineHeight + 2); // Certifica que há espaço para a linha
                    const maxWidth = pageWidth - 2 * margin - indent;
                    
                    doc.setFontSize(10);
                    doc.setTextColor(0, 0, 0); // Preto para o texto principal
                    doc.setFont("Helvetica", "normal"); // Reset font style

                    const labelText = `${label}: `;
                    let valueText = String(value || 'Não informado');

                    // Se o label for bold, imprime label e valor
                    if (isBoldLabel) {
                        doc.setFont("Helvetica", "bold");
                        let currentX = margin + indent;
                        let labelWidth = doc.getTextWidth(labelText);

                        // Dividir o valor em linhas para se ajustar à largura restante
                        const remainingWidth = maxWidth - labelWidth;
                        const valueLines = doc.splitTextToSize(valueText, remainingWidth);

                        if (valueLines.length > 0 && labelWidth + doc.getTextWidth(valueLines[0]) < maxWidth) {
                            // Label e primeira linha do valor cabem na mesma linha
                            doc.text(labelText, currentX, yPosition);
                            doc.setFont("Helvetica", "normal");
                            doc.text(valueLines[0], currentX + labelWidth, yPosition);
                            yPosition += lineHeight;

                            // Imprime as linhas restantes do valor, se houver
                            for (let i = 1; i < valueLines.length; i++) {
                                addNewPageIfNeeded(lineHeight);
                                doc.text(valueLines[i], currentX + labelWidth, yPosition);
                                yPosition += lineHeight;
                            }
                        } else {
                            // Label não cabe ou não tem espaço para o valor na mesma linha, então quebra o label
                            const labelLines = doc.splitTextToSize(labelText, maxWidth);
                            labelLines.forEach(line => {
                                addNewPageIfNeeded(lineHeight);
                                doc.text(line, currentX, yPosition);
                                yPosition += lineHeight;
                            });
                            // Imprime o valor em novas linhas, recuado
                            doc.setFont("Helvetica", "normal");
                            const fullValueLines = doc.splitTextToSize(valueText, maxWidth);
                            fullValueLines.forEach(line => {
                                addNewPageIfNeeded(lineHeight);
                                doc.text(line, currentX + 5, yPosition); // Recuo adicional para o valor
                                yPosition += lineHeight;
                            });
                        }
                    } else {
                        // Apenas texto normal (usado para parágrafos da declaração ou detalhes de explicação)
                        const lines = doc.splitTextToSize(valueText, maxWidth);
                        lines.forEach(line => {
                            addNewPageIfNeeded(lineHeight);
                            doc.text(line, margin + indent, yPosition);
                            yPosition += lineHeight;
                        });
                    }
                    addSpacer(1); // Pequeno espaço após cada entrada de texto
                }
                
                function addSpacer(height = 3) {
                    yPosition += height;
                }

                function addHorizontalLine(width = 0.2, color = '#003087') {
                    addNewPageIfNeeded(10);
                    doc.setDrawColor(color);
                    doc.setLineWidth(width);
                    doc.line(margin, yPosition, pageWidth - margin, yPosition);
                    yPosition += 5;
                    addSpacer();
                }

                // --- Geração do Conteúdo do PDF ---
                drawHeader();
                drawPageBorder();

                // Informações Pessoais
                addSectionTitle("Informações Pessoais");
                addText("Nome Completo", solicitanteNome);
                addText("Outros Nomes Utilizados", formData.get('outrosNomes') || 'Não');
                addText("CPF", formData.get('cpf') || 'Não informado');
                addText("Data de Nascimento", formatDateBr(formData.get('nascimento')));
                addText("Local de Nascimento", formData.get('localNascimento'));
                addText("Sexo", formData.get('sexo'));
                addText("Estado Civil", formData.get('estadoCivil'));

                if (formData.get('estadoCivil') === 'Casado' || formData.get('estadoCivil') === 'Divorciado' || formData.get('estadoCivil') === 'Viúvo' || formData.get('estadoCivil') === 'União Estável') {
                    addSubSectionTitle("Dados do Cônjuge");
                    addText("Nome do Cônjuge", formData.get('spouseNome') || 'Não informado');
                    addText("Data de Nascimento do Cônjuge", formatDateBr(formData.get('spouseNascimento')) || 'Não informado');
                    addText("Local de Nascimento do Cônjuge", formData.get('spouseLocalNascimento') || 'Não informado');
                    if (formData.get('estadoCivil') === 'Viúvo') {
                        addText("Data de Falecimento do Cônjuge", formatDateBr(formData.get('spouseFalecimento')) || 'Não informado');
                    }
                }
                addHorizontalLine();

                addText("Nacionalidade Atual", formData.get('nacionalidade'));
                addText("Outras Nacionalidades", formData.get('outrasNacionalidades') || 'Não possui');
                addText("Número do Passaporte", formData.get('passaporte'));
                addText("Data de Emissão do Passaporte", formatDateBr(formData.get('dataEmissaoPassaporte')));
                addText("Data de Validade do Passaporte", formatDateBr(formData.get('dataValidadePassaporte')));
                addText("Local de Emissão do Passaporte", formData.get('localEmissaoPassaporte'));
                addHorizontalLine();

                // Informações de Contato
                addSectionTitle("Informações de Contato");
                addText("CEP", formData.get('cep'));
                addText("Endereço Completo", formData.get('endereco'));
                addText("Cidade", formData.get('cidade'));
                addText("Estado/Província", formData.get('estado'));
                addText("País", formData.get('pais'));
                addText("Telefone", formData.get('telefone'));
                addText("E-mail", formData.get('email'));
                addHorizontalLine();

                // Informações Familiares
                addSectionTitle("Informações Familiares");
                addText("Pais Vivos?", formData.get('temPaisVivos'));
                if (formData.get('temPaisVivos') === 'Sim') {
                    addText("Nome do Pai", formData.get('nomePai') || 'Não informado');
                    addText("Data de Nascimento do Pai", formatDateBr(formData.get('nascimentoPai')) || 'Não informado');
                    addText("Nome da Mãe", formData.get('nomeMae') || 'Não informado');
                    addText("Data de Nascimento da Mãe", formatDateBr(formData.get('nascimentoMae')) || 'Não informado');
                    addText("Pais nos EUA?", formData.get('paisNosEUA'));
                    if (formData.get('paisNosEUA') === 'Sim') {
                        addText("Explicação sobre Pais nos EUA", formData.get('explicacaoPaisEUA') || 'Não informado');
                    }
                }

                addText("Tem Conhecidos nos EUA?", formData.get('temConhecidosEUA'));
                if (formData.get('temConhecidosEUA') === 'Sim') {
                    addSubSectionTitle("Dados do Conhecido nos EUA");
                    addText("Nome do Conhecido", formData.get('nomeConhecido') || 'Não informado');
                    addText("Telefone do Conhecido", formData.get('telefoneConhecido') || 'Não informado');
                    addText("E-mail do Conhecido", formData.get('emailConhecido') || 'Não informado');
                    addText("Vínculo com o Conhecido", formData.get('vinculoConhecido') || 'Não informado');
                }
                addHorizontalLine();

                // Detalhes da Viagem
                addSectionTitle("Detalhes da Viagem");
                addText("Objetivo da Viagem", formData.get('objetivo'));
                addText("Data Prevista de Chegada", formatDateBr(formData.get('chegada')));
                addText("Tempo de Estadia Pretendido", formData.get('tempo'));
                addText("Endereço nos EUA", formData.get('enderecoEUA') || 'Não informado');
                addText("Quem Paga pela Viagem", formData.get('quemPaga'));

                if (formData.get('quemPaga') === 'Outra pessoa') {
                    addSubSectionTitle("Dados da Pessoa Pagante");
                    addText("Nome da Pessoa Pagante", formData.get('payerNome') || 'Não informado');
                    addText("Endereço é o mesmo do solicitante?", formData.get('payerSameAddress'));
                    if (formData.get('payerSameAddress') === 'Não') {
                        addText("CEP do Pagante", formData.get('payerCEP') || 'Não informado');
                        addText("Endereço do Pagante", formData.get('payerEndereco') || 'Não informado');
                        addText("Cidade do Pagante", formData.get('payerCidade') || 'Não informado');
                        addText("Estado/Província do Pagante", formData.get('payerEstado') || 'Não informado');
                        addText("País do Pagante", formData.get('payerPais') || 'Não informado');
                    }
                    addText("E-mail do Pagante", formData.get('payerEmail') || 'Não informado');
                    addText("Telefone do Pagante", formData.get('payerTelefone') || 'Não informado');
                    addText("Vínculo com o Pagante", formData.get('payerVinculo') || 'Não informado');
                }

                addText("Vai viajar com alguém?", formData.get('temCompanheiros'));
                if (formData.get('temCompanheiros') === 'Sim') {
                    addSubSectionTitle("Dados dos Companheiros de Viagem");
                    addText("Nome(s) do(s) Companheiro(s)", formData.get('nomeCompanheiro') || 'Não informado');
                    addText("Relação com o(s) Companheiro(s)", formData.get('relacaoCompanheiro') || 'Não informado');
                }
                addHorizontalLine();

                // Informações de Trabalho
                addSectionTitle("Informações de Trabalho");
                addText("Ocupação Atual", formData.get('ocupacao'));
                addText("Nome do Empregador", formData.get('empregador'));
                addText("Endereço do Empregador", formData.get('enderecoEmpregador'));
                addText("Telefone do Empregador", formData.get('telefoneEmpregador'));
                addText("Data de Início no Emprego", formatDateBr(formData.get('dataInicioTrabalho')));
                addText("Renda Mensal", formData.get('rendaMensal'));
                addHorizontalLine();

                // Informações de Educação
                addSectionTitle("Informações de Educação");
                addText("Nível Mais Alto de Educação", formData.get('nivelEducacao'));
                addText("Nome da Instituição", formData.get('instituicao'));
                addText("Endereço da Instituição", formData.get('enderecoInstituicao'));
                addText("Data de Início do Curso", formatDateBr(formData.get('dataInicioEducacao')));
                addText("Data de Conclusão do Curso", formatDateBr(formData.get('dataFimEducacao')));
                addHorizontalLine();

                // Histórico de Viagens
                addSectionTitle("Histórico de Viagens");
                addText("É o Primeiro Visto ou Renovação?", formData.get('primeiroVisto'));
                if (formData.get('primeiroVisto') === 'Renovação') {
                    addSubSectionTitle("Dados do Visto Anterior");
                    addText("Número do Visto Anterior (Renovação)", formData.get('numeroVistoAnteriorRenovacao') || 'Não informado');
                    addText("Data de Emissão do Visto Anterior", formatDateBr(formData.get('dataEmissaoVistoAnterior')) || 'Não informado');
                    addText("Data de Validade do Visto Anterior", formatDateBr(formData.get('dataValidadeVistoAnterior')) || 'Não informado');
                    addText("Local de Emissão do Visto Anterior", formData.get('localEmissaoVistoAnterior') || 'Não informado');
                }

                addText("Já Visitou os EUA Antes?", formData.get('visitouEUA'));
                if (formData.get('visitouEUA') === 'Sim') {
                    addSubSectionTitle("Detalhes da Visita Anterior");
                    addText("Data da Última Visita", formatDateBr(formData.get('dataUltimaVisita')) || 'Não informado');
                    addText("Tempo de Estadia na Última Visita", formData.get('tempoUltimaVisita') || 'Não informado');
                    addText("Número do Visto Anterior", formData.get('numeroVistoAnterior') || 'Não informado');
                }
                addText("Já teve impressão digital dos dedos coletada?", formData.get('impressaoDigital'));
                addText("Países Visitados nos Últimos 5 Anos", formData.get('outrosPaises') || 'Nenhum');
                addText("Já teve Visto Americano Negado?", formData.get('vistoNegado'));
                addText("Já foi Negada Admissão aos EUA ou Entrada Recusada?", formData.get('entradaRecusada'));

                if (formData.get('vistoNegado') === 'Sim' || formData.get('entradaRecusada') === 'Sim') {
                    addText("Detalhes da Negativa/Recusa", formData.get('detalhesVistoNegado') || 'Não informado');
                }
                addHorizontalLine();

                // Declaração
                addSectionTitle("Declaração e Confirmação");
                
                // Pega o nome do campo de declaração para o texto
                const declaracaoNome = formData.get('declaracaoNome') || 'Não informado';

                // Usar addText com isBoldLabel = false para parágrafos completos
                addText('', `Eu, ${declaracaoNome}, declaro, sob as penas da lei, que li e compreendi integralmente todas as questões contidas nesta solicitação de visto e afirmo que as respostas por mim fornecidas são verdadeiras, completas e corretas, conforme o meu melhor conhecimento e convicção.`, false);
                
                addSpacer(5); // Espaço entre parágrafos

                addText('','Declaro estar ciente de que:', false);
                
                // Adiciona a lista numerada
                const olListItems = [
                    'Qualquer declaração falsa, incompleta ou enganosa poderá resultar na recusa permanente do visto ou na negativa de admissão nos Estados Unidos, conforme disposto na legislação aplicável.',
                    'Todas as informações prestadas nesta solicitação constituem declarações juramentadas, realizadas sob pena de perjúrio, nos termos do disposto no 28 U.S.C. § 1746.',
                    'Informações adicionais poderão ser requisitadas pelas autoridades competentes após a análise desta solicitação, sendo minha responsabilidade fornecê-las tempestivamente.',
                    'As informações contidas nesta solicitação poderão ser compartilhadas com outras agências governamentais dos Estados Unidos, que possuem autoridade para utilizá-las para fins de aplicação da lei ou para propósitos imigratórios, conforme permitido pela legislação vigente.',
                    'A fotografia fornecida com esta solicitação poderá ser utilizada pelas autoridades americanas para fins de verificação de identidade, empregabilidade ou outros objetivos legais previstos na legislação dos Estados Unidos.'
                ];

                olListItems.forEach((item, index) => {
                    addNewPageIfNeeded(lineHeight * 2); // Garante espaço para cada item da lista
                    doc.setFontSize(10);
                    doc.setTextColor(0, 0, 0);
                    doc.setFont("Helvetica", "normal");
                    const itemText = `${index + 1}. ${item}`;
                    const lines = doc.splitTextToSize(itemText, pageWidth - 2 * margin - 10); // Recuo para a lista
                    lines.forEach(line => {
                        doc.text(line, margin + 5, yPosition); // Recuo adicional para a lista
                        yPosition += lineHeight;
                    });
                    yPosition += 2; // Pequeno espaço entre os itens da lista
                });

                addSpacer(5);
                addText('','Declaro ainda:', false);

                const olListItems2 = [
                    'Que sou exclusivamente responsável pela autenticidade e exatidão dos documentos apresentados e das informações prestadas nesta solicitação.',
                    'Que tenho pleno conhecimento de que a concessão ou negativa do visto é prerrogativa exclusiva da Autoridade Consular Americana, não cabendo a terceiros qualquer ingerência sobre tal decisão.',
                    'Que estou ciente de que, em processos de renovação de visto, entrevistas presenciais poderão ser exigidas a critério exclusivo da Autoridade Consular Americana.',
                    'Que reconheço que o serviço contratado constitui assessoria relacionada ao processo de preenchimento de documentação, agendamento de biometria e entrevista, não abrangendo serviços de entrega ou retirada de documentos no Centro de Atendimento ao Solicitante de Visto (CASV), sendo necessária a contratação de um agente colaborador, caso eu deseje tais serviços adicionais.',
                    'Que a aposição de minha assinatura eletrônica neste documento possui validade jurídica, conforme a legislação aplicável, e representa meu reconhecimento expresso dos serviços contratados.'
                ];

                olListItems2.forEach((item, index) => {
                    addNewPageIfNeeded(lineHeight * 2);
                    doc.setFontSize(10);
                    doc.setTextColor(0, 0, 0);
                    doc.setFont("Helvetica", "normal");
                    const itemText = `${index + 6}. ${item}`; // Continua a numeração da lista
                    const lines = doc.splitTextToSize(itemText, pageWidth - 2 * margin - 10);
                    lines.forEach(line => {
                        doc.text(line, margin + 5, yPosition);
                        yPosition += lineHeight;
                    });
                    yPosition += 2;
                });

                addSpacer(5);
                addText('','Autorização:', false);
                addText('', `Declaro, por fim, ter revisado e conferido todos os dados por mim apresentados, autorizando expressamente a empresa Objetivo Turismo Ltda., contratada diretamente por mim ou por intermédio de minha agência, a proceder com o envio eletrônico do Formulário DS-160 ao Consulado Americano, bem como a realizar o pagamento das taxas e o agendamento necessários à tramitação do meu pedido de visto.`, false);
                
                addSpacer(5);

                addText("Local da Declaração", formData.get('declaracaoLocal'));
                addText("Data da Declaração", formatDateBr(formData.get('declaracaoData')));
                addText("Concordo com os Termos da Declaração", formData.get('aceiteDeclaracao') ? 'Sim' : 'Não');


                // --- Finaliza o PDF e tenta o upload ---
                const pdfBlob = doc.output('blob');
                const pdfFileName = `VistoAmericano_${solicitanteNome.replace(/\s+/g, '_')}_${new Date().getTime()}.pdf`;
                const storageRef = ref(storage, `visto_forms/${pdfFileName}`); // Caminho no Firebase Storage

                // Upload do PDF
                const snapshot = await uploadBytes(storageRef, pdfBlob);
                const downloadURL = await getDownloadURL(snapshot.ref);

                console.log('PDF uploaded successfully:', downloadURL);

                // --- Envio para o WhatsApp ---
                let whatsappMessage = `*Novo Formulário de Visto Americano Recebido!* \n\n`;
                whatsappMessage += `*Nome do Solicitante:* ${solicitanteNome}\n`;
                whatsappMessage += `*E-mail:* ${formData.get('email')}\n`;
                whatsappMessage += `*Telefone do Cliente:* ${formData.get('telefone')}\n`; // Usar o telefone do solicitante
                whatsappMessage += `*Link para o Formulário Completo (PDF):*\n${downloadURL}\n\n`;
                whatsappMessage += `Por favor, revise o PDF para prosseguir.`;

                const whatsappUrlFixed = `https://wa.me/${fixedWhatsAppNumber}?text=${encodeURIComponent(whatsappMessage)}`;
                window.open(whatsappUrlFixed, '_blank');

                alert('Formulário de Visto Americano enviado com sucesso! O PDF foi gerado e o link enviado para o WhatsApp da nossa empresa.');

            } catch (error) {
                console.error("Erro ao gerar PDF ou enviar para Firebase/WhatsApp:", error);
                alert("Ocorreu um erro ao processar o formulário. Por favor, tente novamente. Verifique o console para mais detalhes.");
            } finally {
                submitButton.disabled = false; // Reabilita o botão
            }
        }
    </script>
</body>
</html>
