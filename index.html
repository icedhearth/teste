<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formulário para Visto Americano</title>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

    <script type="module" src="https://www.gstatic.com/firebasejs/11.5.0/firebase-app.js"></script>
    <script type="module" src="https://www.gstatic.com/firebasejs/11.5.0/firebase-storage.js"></script>
    
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 20px auto;
            padding: 20px;
            background-color: #f4f7f6; /* Cor de fundo suave */
            box-shadow: 0 0 15px rgba(0,0,0,0.1); /* Sombra para profundidade */
            border-radius: 8px; /* Cantos arredondados */
        }
        h1 {
            color: #003087; /* Azul escuro, como a bandeira americana */
            text-align: center;
            margin-bottom: 20px;
        }
        h3 {
            color: #C8102E; /* Vermelho, como a bandeira americana */
            border-bottom: 2px solid #eee; /* Linha sutil abaixo dos títulos */
            padding-bottom: 8px;
            margin-top: 30px;
            font-size: 1.2em;
        }
        h4 {
            color: #333;
            margin-top: 20px;
            margin-bottom: 10px;
            font-size: 1.1em;
            border-bottom: 1px dashed #ccc; /* Linha tracejada para sub-títulos */
            padding-bottom: 5px;
        }
        label {
            display: block;
            margin: 15px 0 5px; /* Espaçamento maior para labels */
            font-weight: bold;
            color: #333;
        }
        input[type="text"],
        input[type="date"],
        input[type="tel"],
        input[type="email"],
        input[type="number"],
        select,
        textarea {
            width: calc(100% - 20px); /* Ajuste para padding */
            padding: 10px;
            margin-bottom: 15px; /* Mais espaço abaixo dos campos */
            border: 1px solid #ccc;
            border-radius: 5px;
            box-sizing: border-box; /* Garante que padding e border não aumentem a largura */
            font-size: 1em;
        }
        textarea {
            resize: vertical; /* Permite redimensionar verticalmente */
            min-height: 60px;
        }
        button {
            background-color: #25D366; /* Cor de WhatsApp */
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1.1em;
            margin-top: 30px;
            display: block;
            width: 100%; /* Botão em largura total */
            transition: background-color 0.3s ease; /* Transição suave no hover */
        }
        button:hover {
            background-color: #20b354;
        }
        /* Estilos para as seções condicionais */
        #spouseInfo, #spouseDeathInfo, #parentsInfo, #previousUSVisaInfo, #travelCompanionsInfo, #visaDeniedDetails, #payerInfo, #payerAddressInfo, #renewalInfo, #parentsInUSInfo, #acquaintancesInfo {
            display: none;
            margin-top: 20px;
            padding: 20px;
            border: 1px dashed #a0a0a0; /* Borda tracejada para destacar */
            border-radius: 8px;
            background-color: #f9f9f9; /* Fundo leve para seções condicionais */
        }
        hr {
            margin: 40px 0; /* Mais espaço para as divisórias */
            border: 0;
            border-top: 2px solid #003087; /* Linha divisória mais proeminente */
        }
        p strong {
            color: #C8102E; /* Destaca o texto "Declaro estar ciente de:" */
        }
        ol {
            margin-left: 25px;
            color: #555;
            line-height: 1.6; /* Melhor legibilidade para listas */
        }
        ol li {
            margin-bottom: 8px; /* Espaço entre itens da lista */
        }
        #aceiteDeclaracao {
            width: auto; /* Checkbox não ocupa 100% */
            margin-left: 10px;
            vertical-align: middle; /* Alinha com o texto */
        }
        .message { 
            margin-top: 20px; 
            padding: 10px; 
            border-radius: 4px; 
            display: none; /* Inicia oculto */
        }
        .message.success { background-color: #d4edda; color: #155724; border-color: #c3e6cb; }
        .message.error { background-color: #f8d7da; color: #721c24; border-color: #f5c6cb; }
        .message.info { background-color: #d1ecf1; color: #0c5460; border-color: #bee5eb; }

        /* Estilos para o conteúdo do PDF (para que pareça um documento, não um formulário interativo) */
        .pdf-content {
            font-family: 'Times New Roman', serif;
            font-size: 11pt; /* Um pouco menor para caber mais */
            line-height: 1.5;
            color: #333;
            padding: 15mm 20mm; /* Margens internas para o PDF */
            box-sizing: border-box; /* Garante que padding não estoure o tamanho da página */
            width: 210mm; /* Largura de uma folha A4 */
            min-height: 297mm; /* Altura de uma folha A4 */
        }
        .pdf-content h1 {
            color: #003087;
            text-align: center;
            margin-bottom: 20px;
            font-size: 20pt;
            page-break-after: avoid; /* Evita quebras de página imediatamente após títulos */
        }
        .pdf-content h3 {
            font-size: 14pt;
            color: #C8102E;
            border-bottom: 1px solid #ccc;
            padding-bottom: 5px;
            margin-top: 25px;
            margin-bottom: 15px;
            page-break-before: auto; /* Permite quebrar antes se necessário */
            page-break-after: avoid;
        }
        .pdf-content h4 {
            font-size: 12pt;
            color: #333;
            margin-top: 15px;
            margin-bottom: 10px;
            border-bottom: 1px dashed #eee;
            padding-bottom: 3px;
            page-break-after: avoid;
        }
        .pdf-content p {
            margin-bottom: 5px;
        }
        .pdf-content ul, .pdf-content ol {
            margin-left: 25px;
            margin-bottom: 10px;
        }
        .pdf-content li {
            margin-bottom: 3px;
        }
        .pdf-content .data-item {
            margin-bottom: 4px;
            display: flex; /* Para alinhar o label e o valor */
            align-items: baseline; /* Alinha o texto na linha de base */
        }
        .pdf-content .data-item strong {
            display: inline-block;
            width: 180px; /* Largura fixa para os labels, ajuste conforme necessário */
            flex-shrink: 0; /* Não permite que encolha */
            font-weight: bold;
            color: #555; /* Cor mais suave para os labels */
        }
        .pdf-content .data-item span {
            flex-grow: 1; /* Permite que o valor ocupe o restante do espaço */
            font-weight: normal;
            color: #000;
            word-wrap: break-word; /* Garante que o texto longo quebre a linha */
        }
        .pdf-content hr {
            border: none;
            border-top: 1px solid #ddd;
            margin: 20px 0;
            page-break-before: avoid; /* Evita quebra de página logo antes do HR */
            page-break-after: avoid;
        }
        .pdf-content .declaration-text {
            text-align: justify;
            margin-top: 20px;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <h1>Formulário para Visto Americano</h1>
    <p>Preencha os dados abaixo. Ao clicar em "Gerar PDF...", um PDF detalhado do seu formulário será gerado, baixado automaticamente e uma mensagem será enviada ao WhatsApp com os dados básicos e um link para o PDF.</p>

    <form id="visaForm" name="visaForm"> 
        <h3>Informações Pessoais</h3>
        <label for="nome">Nome completo (como no passaporte):</label>
        <input type="text" id="nome" name="nome" required>

        <label for="sobrenome">Sobrenome (como no passaporte):</label>
        <input type="text" id="sobrenome" name="sobrenome" required>

        <label for="outrosNomes">Já usou outros nomes? (ex.: nome de solteiro, apelido):</label>
        <input type="text" id="outrosNomes" name="outrosNomes">

        <label for="cpf">CPF:</label>
        <input type="text" id="cpf" name="cpf" maxlength="14" oninput="formatCPF(this)">

        <label for="nascimento">Data de nascimento:</label>
        <input type="date" id="nascimento" name="nascimento" required>

        <label for="localNascimento">Cidade e país de nascimento:</label>
        <input type="text" id="localNascimento" name="localNascimento" required>

        <label for="sexo">Sexo:</label>
        <select id="sexo" name="sexo" required>
            <option value="">Selecione</option>
            <option value="Masculino">Masculino</option>
            <option value="Feminino">Feminino</option>
            <option value="Outro">Outro</option>
        </select>

        <label for="estadoCivil">Estado civil:</label>
        <select id="estadoCivil" name="estadoCivil" required>
            <option value="">Selecione</option>
            <option value="Solteiro">Solteiro</option>
            <option value="Casado">Casado</option>
            <option value="Divorciado">Divorciado</option>
            <option value="Viúvo">Viúvo</option>
            <option value="União Estável">União Estável</option>
        </select>

        <div id="spouseInfo">
            <h4>Dados do Cônjuge</h4>
            <label for="spouseNome">Nome completo do cônjuge:</label>
            <input type="text" id="spouseNome" name="spouseNome">

            <label for="spouseNascimento">Data de nascimento do cônjuge:</label>
            <input type="date" id="spouseNascimento" name="spouseNascimento">

            <label for="spouseLocalNascimento">Cidade e país de nascimento do cônjuge:</label>
            <input type="text" id="spouseLocalNascimento" name="spouseLocalNascimento">

            <div id="spouseDeathInfo">
                <label for="spouseFalecimento">Data de falecimento do cônjuge:</label>
                <input type="date" id="spouseFalecimento" name="spouseFalecimento">
            </div>
        </div>
        <hr>

        <label for="nacionalidade">Nacionalidade atual:</label>
        <input type="text" id="nacionalidade" name="nacionalidade" required>

        <label for="outrasNacionalidades">Possui outras nacionalidades? (Se sim, quais?):</label>
        <input type="text" id="outrasNacionalidades" name="outrasNacionalidades">

        <label for="passaporte">Número do passaporte:</label>
        <input type="text" id="passaporte" name="passaporte" required>

        <label for="dataEmissaoPassaporte">Data de emissão do passaporte:</label>
        <input type="date" id="dataEmissaoPassaporte" name="dataEmissaoPassaporte" required>

        <label for="dataValidadePassaporte">Data de validade do passaporte:</label>
        <input type="date" id="dataValidadePassaporte" name="dataValidadePassaporte" required>

        <label for="localEmissaoPassaporte">Local de emissão do passaporte:</label>
        <input type="text" id="localEmissaoPassaporte" name="localEmissaoPassaporte" required>

        <h3>Informações de Contato</h3>
        <label for="cep">CEP (ex.: 70.340-902):</label>
        <input type="text" id="cep" name="cep" maxlength="10" oninput="formatCEP(this)" required>

        <label for="endereco">Endereço completo (rua, número, bairro):</label>
        <textarea id="endereco" name="endereco" required></textarea>

        <label for="cidade">Cidade:</label>
        <input type="text" id="cidade" name="cidade" required>

        <label for="estado">Estado/Província:</label>
        <input type="text" id="estado" name="estado" required>

        <label for="pais">País:</label>
        <input type="text" id="pais" name="pais" required>

        <label for="telefone">Número de telefone (com código do país):</label>
        <input type="tel" id="telefone" name="telefone" required>

        <label for="emailContato">E-mail de Contato:</label>
        <input type="email" id="emailContato" name="emailContato" required>

        <h3>Informações Familiares</h3>
        <label for="temPaisVivos">Seus pais estão vivos?</label>
        <select id="temPaisVivos" name="temPaisVivos" required>
            <option value="">Selecione</option>
            <option value="Sim">Sim</option>
            <option value="Não">Não</option>
        </select>

        <div id="parentsInfo">
            <label for="nomePai">Nome completo do pai:</label>
            <input type="text" id="nomePai" name="nomePai">

            <label for="nascimentoPai">Data de nascimento do pai:</label>
            <input type="date" id="nascimentoPai" name="nascimentoPai">

            <label for="nomeMae">Nome completo da mãe:</label>
            <input type="text" id="nomeMae" name="nomeMae">

            <label for="nascimentoMae">Data de nascimento da mãe:</label>
            <input type="date" id="nascimentoMae" name="nascimentoMae">

            <label for="paisNosEUA">Seus pais estão nos EUA?</label>
            <select id="paisNosEUA" name="paisNosEUA">
                <option value="">Selecione</option>
                <option value="Sim">Sim</option>
                <option value="Não">Não</option>
            </select>

            <div id="parentsInUSInfo">
                <label for="explicacaoPaisEUA">Explique a situação dos seus pais nos EUA:</label>
                <textarea id="explicacaoPaisEUA" name="explicacaoPaisEUA"></textarea>
            </div>
        </div>

        <label for="temConhecidosEUA">Tem conhecidos nos EUA?</label>
        <select id="temConhecidosEUA" name="temConhecidosEUA" required>
            <option value="">Selecione</option>
            <option value="Sim">Sim</option>
            <option value="Não">Não</option>
        </select>

        <div id="acquaintancesInfo">
            <h4>Dados do Conhecido nos EUA</h4>
            <label for="nomeConhecido">Nome completo do conhecido:</label>
            <input type="text" id="nomeConhecido" name="nomeConhecido">

            <label for="telefoneConhecido">Telefone do conhecido (com código do país):</label>
            <input type="tel" id="telefoneConhecido" name="telefoneConhecido">

            <label for="emailConhecido">E-mail do conhecido:</label>
            <input type="email" id="emailConhecido" name="emailConhecido">

            <label for="vinculoConhecido">Vínculo com o solicitante (ex.: amigo, parente):</label>
            <input type="text" id="vinculoConhecido" name="vinculoConhecido">
        </div>

        <h3>Detalhes da Viagem</h3>
        <label for="objetivo">Objetivo da viagem aos EUA:</label>
        <select id="objetivo" name="objetivo" required>
            <option value="">Selecione</option>
            <option value="Turismo">Turismo</option>
            <option value="Negócios">Negócios</option>
            <option value="Estudo">Estudo</option>
            <option value="Trabalho">Trabalho</option>
            <option value="Visita a Familiares">Visita a Familiares</option>
            <option value="Outro">Outro</option>
        </select>

        <label for="chegada">Data prevista de chegada aos EUA:</label>
        <input type="date" id="chegada" name="chegada" required>

        <label for="tempo">Quanto tempo pretende ficar nos EUA? (ex.: 2 semanas, 6 meses):</label>
        <input type="text" id="tempo" name="tempo" required>

        <label for="enderecoEUA">Endereço onde ficará nos EUA (rua, cidade, estado, CEP):</label>
        <textarea id="enderecoEUA" name="enderecoEUA" placeholder="Digite o endereço, se disponível (Não obrigatório)"></textarea>

        <label for="quemPaga">Quem está pagando pela viagem?</label>
        <select id="quemPaga" name="quemPaga" required>
            <option value="">Selecione</option>
            <option value="Eu mesmo">Eu mesmo</option>
            <option value="Outra pessoa">Outra pessoa</option>
        </select>

        <div id="payerInfo">
            <h4>Dados da Pessoa Pagante</h4>
            <label for="payerNome">Nome completo da pessoa pagante:</label>
            <input type="text" id="payerNome" name="payerNome">

            <label for="payerSameAddress">O endereço é o mesmo do solicitante?</label>
            <select id="payerSameAddress" name="payerSameAddress">
                <option value="">Selecione</option>
                <option value="Sim">Sim</option>
                <option value="Não">Não</option>
            </select>

            <div id="payerAddressInfo">
                <label for="payerCEP">CEP (ex.: 70.340-902):</label>
                <input type="text" id="payerCEP" name="payerCEP" maxlength="10" oninput="formatCEP(this)">

                <label for="payerEndereco">Endereço completo (rua, número, bairro):</label>
                <textarea id="payerEndereco" name="payerEndereco"></textarea>

                <label for="payerCidade">Cidade:</label>
                <input type="text" id="payerCidade" name="payerCidade">

                <label for="payerEstado">Estado/Província:</label>
                <input type="text" id="payerEstado" name="payerEstado">

                <label for="payerPais">País:</label>
                <input type="text" id="payerPais" name="payerPais">
            </div>

            <label for="payerEmail">E-mail da pessoa pagante:</label>
            <input type="email" id="payerEmail" name="payerEmail">

            <label for="payerTelefone">Telefone da pessoa pagante (com código do país):</label>
            <input type="tel" id="payerTelefone" name="payerTelefone">

            <label for="payerVinculo">Vínculo com o solicitante (ex.: pai, amigo, empregador):</label>
            <input type="text" id="payerVinculo" name="payerVinculo">
        </div>

        <label for="temCompanheiros">Vai viajar com alguém?</label>
        <select id="temCompanheiros" name="temCompanheiros" required>
            <option value="">Selecione</option>
            <option value="Sim">Sim</option>
            <option value="Não">Não</option>
        </select>

        <div id="travelCompanionsInfo">
            <label for="nomeCompanheiro">Nome completo do(s) companheiro(s) de viagem:</label>
            <textarea id="nomeCompanheiro" name="nomeCompanheiro"></textarea>

            <label for="relacaoCompanheiro">Relação com o(s) companheiro(s) (ex.: amigo, colega):</label>
            <input type="text" id="relacaoCompanheiro" name="relacaoCompanheiro">
        </div>

        <h3>Informações de Trabalho</h3>
        <label for="ocupacao">Ocupação atual:</label>
        <input type="text" id="ocupacao" name="ocupacao" required>

        <label for="empregador">Nome do empregador:</label>
        <input type="text" id="empregador" name="empregador" required>

        <label for="enderecoEmpregador">Endereço do empregador:</label>
        <textarea id="enderecoEmpregador" name="enderecoEmpregador" required></textarea>

        <label for="telefoneEmpregador">Telefone do empregador:</label>
        <input type="tel" id="telefoneEmpregador" name="telefoneEmpregador" required>

        <label for="dataInicioTrabalho">Data de início no emprego:</label>
        <input type="date" id="dataInicioTrabalho" name="dataInicioTrabalho" required>

        <label for="rendaMensal">Renda mensal (em reais):</label>
        <input type="text" id="rendaMensal" name="rendaMensal" required>

        <h3>Informações de Educação</h3>
        <label for="nivelEducacao">Nível mais alto de educação concluído:</label>
        <select id="nivelEducacao" name="nivelEducacao" required>
            <option value="">Selecione</option>
            <option value="Ensino Fundamental">Ensino Fundamental</option>
            <option value="Ensino Médio">Ensino Médio</option>
            <option value="Ensino Superior">Ensino Superior</option>
            <option value="Pós-Graduação">Pós-Graduação</option>
        </select>

        <label for="instituicao">Nome da instituição educacional:</label>
        <input type="text" id="instituicao" name="instituicao" required>

        <label for="enderecoInstituicao">Endereço da instituição:</label>
        <textarea id="enderecoInstituicao" name="enderecoInstituicao" required></textarea>

        <label for="dataInicioEducacao">Data de início do curso:</label>
        <input type="date" id="dataInicioEducacao" name="dataInicioEducacao" required>

        <label for="dataFimEducacao">Data de conclusão do curso:</label>
        <input type="date" id="dataFimEducacao" name="dataFimEducacao" required>

        <h3>Histórico de Viagens</h3>
        <label for="primeiroVisto">É o seu primeiro visto ou uma renovação?</label>
        <select id="primeiroVisto" name="primeiroVisto" required>
            <option value="">Selecione</option>
            <option value="Primeiro visto">Primeiro visto</option>
            <option value="Renovação">Renovação</option>
        </select>

        <div id="renewalInfo">
            <label for="numeroVistoAnteriorRenovacao">Número do visto anterior:</label>
            <input type="text" id="numeroVistoAnteriorRenovacao" name="numeroVistoAnteriorRenovacao">

            <label for="dataEmissaoVistoAnterior">Data de emissão do visto anterior:</label>
            <input type="date" id="dataEmissaoVistoAnterior" name="dataEmissaoVistoAnterior">

            <label for="dataValidadeVistoAnterior">Data de validade do visto anterior:</label>
            <input type="date" id="dataValidadeVistoAnterior" name="dataValidadeVistoAnterior">

            <label for="localEmissaoVistoAnterior">Local de emissão do visto anterior:</label>
            <input type="text" id="localEmissaoVistoAnterior" name="localEmissaoVistoAnterior">
        </div>

        <label for="visitouEUA">Já visitou os EUA antes?</label>
        <select id="visitouEUA" name="visitouEUA" required>
            <option value="">Selecione</option>
            <option value="Sim">Sim</option>
            <option value="Não">Não</option>
        </select>

        <label for="impressaoDigital">Já teve impressão digital dos dedos coletada?</label>
        <select id="impressaoDigital" name="impressaoDigital" required>
            <option value="">Selecione</option>
            <option value="Sim">Sim</option>
            <option value="Não">Não</option>
        </select>

        <div id="previousUSVisaInfo">
            <label for="dataUltimaVisita">Data da última visita aos EUA:</label>
            <input type="date" id="dataUltimaVisita" name="dataUltimaVisita">

            <label for="tempoUltimaVisita">Tempo de estadia na última visita:</label>
            <input type="text" id="tempoUltimaVisita" name="tempoUltimaVisita">

            <label for="numeroVistoAnterior">Número do visto anterior (se aplicável):</label>
            <input type="text" id="numeroVistoAnterior" name="numeroVistoAnterior">
        </div>

        <label for="outrosPaises">Países visitados nos últimos 5 anos:</label>
        <textarea id="outrosPaises" name="outrosPaises"></textarea>

        <label for="vistoNegado">Já teve um visto americano negado?</label>
        <select id="vistoNegado" name="vistoNegado" required>
            <option value="">Selecione</option>
            <option value="Sim">Sim</option>
            <option value="Não">Não</option>
        </select>

        <label for="entradaRecusada">Já foi negada admissão aos EUA ou teve entrada recusada?</label>
        <select id="entradaRecusada" name="entradaRecusada" required>
            <option value="">Selecione</option>
            <option value="Sim">Sim</option>
            <option value="Não">Não</option>
        </select>

        <div id="visaDeniedDetails">
            <label for="detalhesVistoNegado">Detalhes da negativa (data e motivo):</label>
            <textarea id="detalhesVistoNegado" name="detalhesVistoNegado"></textarea>
        </div>

        <h3>Declaração</h3>
        <p class="declaration-text">Eu, <input type="text" id="declaracaoNome" name="declaracaoNome" placeholder="Nome completo" required>, declaro, sob as penas da lei, que li e compreendi integralmente todas as questões contidas nesta solicitação de visto e afirmo que as respostas por mim fornecidas são verdadeiras, completas e corretas, conforme o meu melhor conhecimento e convicção.</p>

        <p class="declaration-text"><strong>Declaro estar ciente de:</strong></p>
        <ol>
            <li>Qualquer declaração falsa, incompleta ou enganosa poderá resultar na recusa permanente do visto ou na negativa de admissão nos Estados Unidos, conforme disposto na legislação aplicável.</li>
            <li>Todas as informações prestadas nesta solicitação constituem declarações juramentadas, realizadas sob pena de perjúrio, nos termos do disposto no <em>28 U.S.C. § 1746</em>.</li>
            <li>Informações adicionais poderão ser requisitadas pelas autoridades competentes após a análise desta solicitação, sendo minha responsabilidade fornecê-las tempestivamente.</li>
            <li>As informações contidas nesta solicitação poderão ser compartilhadas com outras agências governamentais dos Estados Unidos, que possuem autoridade para utilizá-las para fins de aplicação da lei ou para propósitos imigratórios, conforme permitido pela legislação vigente.</li>
            <li>A fotografia fornecida com esta solicitação poderá ser utilizada pelas autoridades americanas para fins de verificação de identidade, empregabilidade ou outros objetivos legais previstos na legislação dos Estados Unidos.</li>
        </ol>

        <p class="declaration-text"><strong>Declaro ainda:</strong></p>
        <ol start="6">
            <li>Que sou exclusivamente responsável pela autenticidade e exatidão dos documentos apresentados e das informações prestadas nesta solicitação.</li>
            <li>Que tenho pleno conhecimento de que a concessão ou negativa do visto é prerrogativa exclusiva da Autoridade Consular Americana, não cabendo a terceiros qualquer ingerência sobre tal decisão.</li>
            <li>Que estou ciente de que, em processos de renovação de visto, entrevistas presenciais poderão ser exigidas a critério exclusivo da Autoridade Consular Americana.</li>
            <li>Que reconheço que o serviço contratado constitui assessoria relacionada ao processo de preenchimento de documentação, agendamento de biometria e entrevista, não abrangendo serviços de entrega ou retirada de documentos no Centro de Atendimento ao Solicitante de Visto (CASV), sendo necessária a contratação de um agente colaborador, caso eu deseje tais serviços adicionais.</li>
            <li>Que a aposição de minha assinatura eletrônica neste documento possui validade jurídica, conforme a legislação aplicável, e representa meu reconhecimento expresso dos serviços contratados.</li>
        </ol>

        <p class="declaration-text"><strong>Autorização:</strong></p>
        <p class="declaration-text">Declaro, por fim, ter revisado e conferido todos os dados por mim apresentados, autorizando expressamente a empresa <strong>Objetivo Turismo Ltda.</strong>, contratada diretamente por mim ou por intermédio de minha agência, a proceder com o envio eletrônico do Formulário DS-160 ao Consulado Americano, bem como a realizar o pagamento das taxas e o agendamento necessários à tramitação do meu pedido de visto.</p>

        <label for="declaracaoLocal">Local:</label>
        <input type="text" id="declaracaoLocal" name="declaracaoLocal" required>

        <label for="declaracaoData">Data:</label>
        <input type="date" id="declaracaoData" name="declaracaoData" required>

        <label>Concordo com os termos desta declaração <input type="checkbox" id="aceiteDeclaracao" name="aceiteDeclaracao" required style="width: auto; margin-left: 10px;"></label>
    </form>

    <button type="button" id="btnProcessar">Gerar PDF, Download e Enviar WhatsApp</button>
    
    <div class="message" id="statusMessage"></div>

    <script type="module">
        // Importa as funções necessárias do Firebase SDK
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.5.0/firebase-app.js";
        import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/11.5.0/firebase-storage.js";

        // --- Configuração do Firebase (SUAS CREDENCIAIS REAIS) ---
        const firebaseConfig = {
            apiKey: "AIzaSyAkBV0rHEghBOHl2mDOs6rMDHkUgYMxFr0", 
            authDomain: "visaformulariostorage.firebaseapp.com",
            projectId: "visaformulariostorage",
            storageBucket: "visaformulariostorage.firebasestorage.app", 
            messagingSenderId: "720170394408",
            appId: "1:720170394408:web:b1c294c39c489388f6261d",
            measurementId: "G-ZFCV4JEEFT"
        };

        // Inicializa o Firebase
        const app = initializeApp(firebaseConfig);
        const storage = getStorage(app); 

        // Referência para a mensagem de status
        const statusMessageDiv = document.getElementById('statusMessage');

        // Número de telefone FIXO para o WhatsApp
        const whatsappTargetNumber = "556199998165"; // Brasília DDD 61

        function showMessage(message, type = 'info') {
            statusMessageDiv.textContent = message;
            statusMessageDiv.className = `message ${type}`;
            statusMessageDiv.style.display = 'block'; 
        }

        // --- Funções de Formatação de CPF e CEP ---
        window.formatCPF = function(input) {
            let value = input.value.replace(/\D/g, '');
            if (value.length > 11) value = value.slice(0, 11);
            value = value.replace(/(\d{3})(\d)/, '$1.$2');
            value = value.replace(/(\d{3})(\d)/, '$1.$2');
            value = value.replace(/(\d{3})(\d{1,2})$/, '$1-$2');
            input.value = value;
        }

        window.formatCEP = function(input) {
            let value = input.value.replace(/\D/g, '');
            if (value.length > 8) value = value.slice(0, 8);
            value = value.replace(/^(\d{5})(\d)/, '$1-$2');
            input.value = value;
        }

        // Função para formatar números de telefone para WhatsApp (apenas números)
        function formatPhoneNumberForWhatsApp(phone) {
            return phone.replace(/\D/g, ''); // Remove todos os caracteres não numéricos
        }

        // Função para formatar a data para exibição
        function formatDateForDisplay(dateString) {
            if (!dateString) return "Não informado";
            const date = new Date(dateString + 'T00:00:00'); // Adiciona T00:00:00 para evitar problemas de fuso horário
            if (isNaN(date.getTime())) return "Não informado"; // Verifica se a data é válida
            return date.toLocaleDateString('pt-BR', { year: 'numeric', month: '2-digit', day: '2-digit' });
        }

        // Função principal para gerar o conteúdo HTML do PDF a partir dos dados do formulário
        function generatePdfContent(formData) {
            let content = `
                <div class="pdf-content">
                    <h1>Formulário de Solicitação de Visto Americano</h1>
                    
                    <h3>Informações Pessoais</h3>
                    <div class="data-item"><strong>Nome Completo:</strong> <span>${formData.get('nome') || 'Não informado'} ${formData.get('sobrenome') || ''}</span></div>
                    <div class="data-item"><strong>Outros Nomes Utilizados:</strong> <span>${formData.get('outrosNomes') || 'Não'}</span></div>
                    <div class="data-item"><strong>CPF:</strong> <span>${formData.get('cpf') || 'Não informado'}</span></div>
                    <div class="data-item"><strong>Data de Nascimento:</strong> <span>${formatDateForDisplay(formData.get('nascimento'))}</span></div>
                    <div class="data-item"><strong>Local de Nascimento:</strong> <span>${formData.get('localNascimento') || 'Não informado'}</span></div>
                    <div class="data-item"><strong>Sexo:</strong> <span>${formData.get('sexo') || 'Não informado'}</span></div>
                    <div class="data-item"><strong>Estado Civil:</strong> <span>${formData.get('estadoCivil') || 'Não informado'}</span></div>
            `;

            if (formData.get('estadoCivil') === 'Casado' || formData.get('estadoCivil') === 'Divorciado' || formData.get('estadoCivil') === 'Viúvo' || formData.get('estadoCivil') === 'União Estável') {
                content += `
                    <h4>Dados do Cônjuge</h4>
                    <div class="data-item"><strong>Nome do Cônjuge:</strong> <span>${formData.get('spouseNome') || 'Não informado'}</span></div>
                    <div class="data-item"><strong>Data de Nascimento do Cônjuge:</strong> <span>${formatDateForDisplay(formData.get('spouseNascimento'))}</span></div>
                    <div class="data-item"><strong>Local de Nascimento do Cônjuge:</strong> <span>${formData.get('spouseLocalNascimento') || 'Não informado'}</span></div>
                `;
                if (formData.get('estadoCivil') === 'Viúvo') {
                    content += `<div class="data-item"><strong>Data de Falecimento do Cônjuge:</strong> <span>${formatDateForDisplay(formData.get('spouseFalecimento'))}</span></div>`;
                }
            }

            content += `
                    <hr>
                    <div class="data-item"><strong>Nacionalidade Atual:</strong> <span>${formData.get('nacionalidade') || 'Não informado'}</span></div>
                    <div class="data-item"><strong>Outras Nacionalidades:</strong> <span>${formData.get('outrasNacionalidades') || 'Não possui'}</span></div>
                    <div class="data-item"><strong>Número do Passaporte:</strong> <span>${formData.get('passaporte') || 'Não informado'}</span></div>
                    <div class="data-item"><strong>Data de Emissão do Passaporte:</strong> <span>${formatDateForDisplay(formData.get('dataEmissaoPassaporte'))}</span></div>
                    <div class="data-item"><strong>Data de Validade do Passaporte:</strong> <span>${formatDateForDisplay(formData.get('dataValidadePassaporte'))}</span></div>
                    <div class="data-item"><strong>Local de Emissão do Passaporte:</strong> <span>${formData.get('localEmissaoPassaporte') || 'Não informado'}</span></div>

                    <h3>Informações de Contato</h3>
                    <div class="data-item"><strong>CEP:</strong> <span>${formData.get('cep') || 'Não informado'}</span></div>
                    <div class="data-item"><strong>Endereço Completo:</strong> <span>${formData.get('endereco') || 'Não informado'}</span></div>
                    <div class="data-item"><strong>Cidade:</strong> <span>${formData.get('cidade') || 'Não informado'}</span></div>
                    <div class="data-item"><strong>Estado/Província:</strong> <span>${formData.get('estado') || 'Não informado'}</span></div>
                    <div class="data-item"><strong>País:</strong> <span>${formData.get('pais') || 'Não informado'}</span></div>
                    <div class="data-item"><strong>Telefone:</strong> <span>${formData.get('telefone') || 'Não informado'}</span></div>
                    <div class="data-item"><strong>E-mail:</strong> <span>${formData.get('emailContato') || 'Não informado'}</span></div>

                    <h3>Informações Familiares</h3>
                    <div class="data-item"><strong>Seus Pais Estão Vivos?:</strong> <span>${formData.get('temPaisVivos') || 'Não informado'}</span></div>
            `;

            if (formData.get('temPaisVivos') === 'Sim') {
                content += `
                    <div class="data-item"><strong>Nome do Pai:</strong> <span>${formData.get('nomePai') || 'Não informado'}</span></div>
                    <div class="data-item"><strong>Data de Nascimento do Pai:</strong> <span>${formatDateForDisplay(formData.get('nascimentoPai'))}</span></div>
                    <div class="data-item"><strong>Nome da Mãe:</strong> <span>${formData.get('nomeMae') || 'Não informado'}</span></div>
                    <div class="data-item"><strong>Data de Nascimento da Mãe:</strong> <span>${formatDateForDisplay(formData.get('nascimentoMae'))}</span></div>
                    <div class="data-item"><strong>Pais nos EUA?:</strong> <span>${formData.get('paisNosEUA') || 'Não informado'}</span></div>
                `;
                if (formData.get('paisNosEUA') === 'Sim') {
                    content += `<div class="data-item"><strong>Explicação sobre Pais nos EUA:</strong> <span>${formData.get('explicacaoPaisEUA') || 'Não informado'}</span></div>`;
                }
            }

            content += `
                    <div class="data-item"><strong>Tem Conhecidos nos EUA?:</strong> <span>${formData.get('temConhecidosEUA') || 'Não informado'}</span></div>
            `;
            if (formData.get('temConhecidosEUA') === 'Sim') {
                content += `
                    <h4>Dados do Conhecido nos EUA</h4>
                    <div class="data-item"><strong>Nome do Conhecido:</strong> <span>${formData.get('nomeConhecido') || 'Não informado'}</span></div>
                    <div class="data-item"><strong>Telefone do Conhecido:</strong> <span>${formData.get('telefoneConhecido') || 'Não informado'}</span></div>
                    <div class="data-item"><strong>E-mail do Conhecido:</strong> <span>${formData.get('emailConhecido') || 'Não informado'}</span></div>
                    <div class="data-item"><strong>Vínculo com Solicitante:</strong> <span>${formData.get('vinculoConhecido') || 'Não informado'}</span></div>
                `;
            }

            content += `
                    <h3>Detalhes da Viagem</h3>
                    <div class="data-item"><strong>Objetivo da Viagem:</strong> <span>${formData.get('objetivo') || 'Não informado'}</span></div>
                    <div class="data-item"><strong>Data Prevista de Chegada:</strong> <span>${formatDateForDisplay(formData.get('chegada'))}</span></div>
                    <div class="data-item"><strong>Tempo de Estadia Pretendido:</strong> <span>${formData.get('tempo') || 'Não informado'}</span></div>
                    <div class="data-item"><strong>Endereço nos EUA:</strong> <span>${formData.get('enderecoEUA') || 'Não informado'}</span></div>
                    <div class="data-item"><strong>Quem Paga pela Viagem:</strong> <span>${formData.get('quemPaga') || 'Não informado'}</span></div>
            `;

            if (formData.get('quemPaga') === 'Outra pessoa') {
                content += `
                    <h4>Dados da Pessoa Pagante</h4>
                    <div class="data-item"><strong>Nome da Pessoa Pagante:</strong> <span>${formData.get('payerNome') || 'Não informado'}</span></div>
                `;
                if (formData.get('payerSameAddress') === 'Não') {
                    content += `
                        <div class="data-item"><strong>CEP do Pagante:</strong> <span>${formData.get('payerCEP') || 'Não informado'}</span></div>
                        <div class="data-item"><strong>Endereço do Pagante:</strong> <span>${formData.get('payerEndereco') || 'Não informado'}</span></div>
                        <div class="data-item"><strong>Cidade do Pagante:</strong> <span>${formData.get('payerCidade') || 'Não informado'}</span></div>
                        <div class="data-item"><strong>Estado/Província do Pagante:</strong> <span>${formData.get('payerEstado') || 'Não informado'}</span></div>
                        <div class="data-item"><strong>País do Pagante:</strong> <span>${formData.get('payerPais') || 'Não informado'}</span></div>
                    `;
                } else {
                    content += `<div class="data-item"><strong>Endereço do Pagante:</strong> <span>Mesmo do Solicitante</span></div>`;
                }
                content += `
                    <div class="data-item"><strong>E-mail do Pagante:</strong> <span>${formData.get('payerEmail') || 'Não informado'}</span></div>
                    <div class="data-item"><strong>Telefone do Pagante:</strong> <span>${formData.get('payerTelefone') || 'Não informado'}</span></div>
                    <div class="data-item"><strong>Vínculo do Pagante:</strong> <span>${formData.get('payerVinculo') || 'Não informado'}</span></div>
                `;
            }

            content += `
                    <div class="data-item"><strong>Vai viajar com alguém?:</strong> <span>${formData.get('temCompanheiros') || 'Não informado'}</span></div>
            `;
            if (formData.get('temCompanheiros') === 'Sim') {
                content += `
                    <div class="data-item"><strong>Nome do(s) Companheiro(s):</strong> <span>${formData.get('nomeCompanheiro') || 'Não informado'}</span></div>
                    <div class="data-item"><strong>Relação com Companheiro(s):</strong> <span>${formData.get('relacaoCompanheiro') || 'Não informado'}</span></div>
                `;
            }

            content += `
                    <h3>Informações de Trabalho</h3>
                    <div class="data-item"><strong>Ocupação Atual:</strong> <span>${formData.get('ocupacao') || 'Não informado'}</span></div>
                    <div class="data-item"><strong>Nome do Empregador:</strong> <span>${formData.get('empregador') || 'Não informado'}</span></div>
                    <div class="data-item"><strong>Endereço do Empregador:</strong> <span>${formData.get('enderecoEmpregador') || 'Não informado'}</span></div>
                    <div class="data-item"><strong>Telefone do Empregador:</strong> <span>${formData.get('telefoneEmpregador') || 'Não informado'}</span></div>
                    <div class="data-item"><strong>Data de Início no Emprego:</strong> <span>${formatDateForDisplay(formData.get('dataInicioTrabalho'))}</span></div>
                    <div class="data-item"><strong>Renda Mensal:</strong> <span>${formData.get('rendaMensal') ? `R$ ${formData.get('rendaMensal')}` : 'Não informado'}</span></div>

                    <h3>Informações de Educação</h3>
                    <div class="data-item"><strong>Nível Mais Alto de Educação:</strong> <span>${formData.get('nivelEducacao') || 'Não informado'}</span></div>
                    <div class="data-item"><strong>Nome da Instituição:</strong> <span>${formData.get('instituicao') || 'Não informado'}</span></div>
                    <div class="data-item"><strong>Endereço da Instituição:</strong> <span>${formData.get('enderecoInstituicao') || 'Não informado'}</span></div>
                    <div class="data-item"><strong>Data de Início do Curso:</strong> <span>${formatDateForDisplay(formData.get('dataInicioEducacao'))}</span></div>
                    <div class="data-item"><strong>Data de Conclusão do Curso:</strong> <span>${formatDateForDisplay(formData.get('dataFimEducacao'))}</span></div>

                    <h3>Histórico de Viagens</h3>
                    <div class="data-item"><strong>É o Primeiro Visto ou Renovação?:</strong> <span>${formData.get('primeiroVisto') || 'Não informado'}</span></div>
            `;

            if (formData.get('primeiroVisto') === 'Renovação') {
                content += `
                    <h4>Dados do Visto Anterior (Renovação)</h4>
                    <div class="data-item"><strong>Número do Visto Anterior:</strong> <span>${formData.get('numeroVistoAnteriorRenovacao') || 'Não informado'}</span></div>
                    <div class="data-item"><strong>Data de Emissão do Visto Anterior:</strong> <span>${formatDateForDisplay(formData.get('dataEmissaoVistoAnterior'))}</span></div>
                    <div class="data-item"><strong>Data de Validade do Visto Anterior:</strong> <span>${formatDateForDisplay(formData.get('dataValidadeVistoAnterior'))}</span></div>
                    <div class="data-item"><strong>Local de Emissão do Visto Anterior:</strong> <span>${formData.get('localEmissaoVistoAnterior') || 'Não informado'}</span></div>
                `;
            }

            content += `
                    <div class="data-item"><strong>Já Visitou os EUA Antes?:</strong> <span>${formData.get('visitouEUA') || 'Não informado'}</span></div>
            `;
            if (formData.get('visitouEUA') === 'Sim') {
                content += `
                    <h4>Última Visita aos EUA</h4>
                    <div class="data-item"><strong>Data da Última Visita:</strong> <span>${formatDateForDisplay(formData.get('dataUltimaVisita'))}</span></div>
                    <div class="data-item"><strong>Tempo de Estadia na Última Visita:</strong> <span>${formData.get('tempoUltimaVisita') || 'Não informado'}</span></div>
                    <div class="data-item"><strong>Número do Visto Anterior:</strong> <span>${formData.get('numeroVistoAnterior') || 'Não informado'}</span></div>
                `;
            }
            content += `
                    <div class="data-item"><strong>Já teve Impressão Digital Coletada?:</strong> <span>${formData.get('impressaoDigital') || 'Não informado'}</span></div>
                    <div class="data-item"><strong>Países Visitados nos Últimos 5 Anos:</strong> <span>${formData.get('outrosPaises') || 'Não informado'}</span></div>
                    <div class="data-item"><strong>Já teve Visto Americano Negado?:</strong> <span>${formData.get('vistoNegado') || 'Não informado'}</span></div>
                    <div class="data-item"><strong>Já teve Entrada Recusada nos EUA?:</strong> <span>${formData.get('entradaRecusada') || 'Não informado'}</span></div>
            `;
            if (formData.get('vistoNegado') === 'Sim' || formData.get('entradaRecusada') === 'Sim') {
                content += `
                    <div class="data-item"><strong>Detalhes da Negativa/Recusa:</strong> <span>${formData.get('detalhesVistoNegado') || 'Não informado'}</span></div>
                `;
            }

            content += `
                    <h3>Declaração</h3>
                    <p class="declaration-text">Eu, <strong>${formData.get('declaracaoNome') || '_________________________'}</strong>, declaro, sob as penas da lei, que li e compreendi integralmente todas as questões contidas nesta solicitação de visto e afirmo que as respostas por mim fornecidas são verdadeiras, completas e corretas, conforme o meu melhor conhecimento e convicção.</p>

                    <p class="declaration-text"><strong>Declaro estar ciente de:</strong></p>
                    <ol>
                        <li>Qualquer declaração falsa, incompleta ou enganosa poderá resultar na recusa permanente do visto ou na negativa de admissão nos Estados Unidos, conforme disposto na legislação aplicável.</li>
                        <li>Todas as informações prestadas nesta solicitação constituem declarações juramentadas, realizadas sob pena de perjúrio, nos termos do disposto no <em>28 U.S.C. § 1746</em>.</li>
                        <li>Informações adicionais poderão ser requisitadas pelas autoridades competentes após a análise desta solicitação, sendo minha responsabilidade fornecê-las tempestivamente.</li>
                        <li>As informações contidas nesta solicitação poderão ser compartilhadas com outras agências governamentais dos Estados Unidos, que possuem autoridade para utilizá-las para fins de aplicação da lei ou para propósitos imigratórios, conforme permitido pela legislação vigente.</li>
                        <li>A fotografia fornecida com esta solicitação poderá ser utilizada pelas autoridades americanas para fins de verificação de identidade, empregabilidade ou outros objetivos legais previstos na legislação dos Estados Unidos.</li>
                    </ol>

                    <p class="declaration-text"><strong>Declaro ainda:</strong></p>
                    <ol start="6">
                        <li>Que sou exclusivamente responsável pela autenticidade e exatidão dos documentos apresentados e das informações prestadas nesta solicitação.</li>
                        <li>Que tenho pleno conhecimento de que a concessão ou negativa do visto é prerrogativa exclusiva da Autoridade Consular Americana, não cabendo a terceiros qualquer ingerência sobre tal decisão.</li>
                        <li>Que estou ciente de que, em processos de renovação de visto, entrevistas presenciais poderão ser exigidas a critério exclusivo da Autoridade Consular Americana.</li>
                        <li>Que reconheço que o serviço contratado constitui assessoria relacionada ao processo de preenchimento de documentação, agendamento de biometria e entrevista, não abrangendo serviços de entrega ou retirada de documentos no Centro de Atendimento ao Solicitante de Visto (CASV), sendo necessária a contratação de um agente colaborador, caso eu deseje tais serviços adicionais.</li>
                        <li>Que a aposição de minha assinatura eletrônica neste documento possui validade jurídica, conforme a legislação aplicável, e representa meu reconhecimento expresso dos serviços contratados.</li>
                    </ol>

                    <p class="declaration-text"><strong>Autorização:</strong></p>
                    <p class="declaration-text">Declaro, por fim, ter revisado e conferido todos os dados por mim apresentados, autorizando expressamente a empresa <strong>Objetivo Turismo Ltda.</strong>, contratada diretamente por mim ou por intermédio de minha agência, a proceder com o envio eletrônico do Formulário DS-160 ao Consulado Americano, bem como a realizar o pagamento das taxas e o agendamento necessários à tramitação do meu pedido de visto.</p>

                    <div class="data-item"><strong>Local:</strong> <span>${formData.get('declaracaoLocal') || 'Não informado'}</span></div>
                    <div class="data-item"><strong>Data da Declaração:</strong> <span>${formatDateForDisplay(formData.get('declaracaoData'))}</span></div>
                    <div class="data-item"><strong>Concordo com os termos:</strong> <span>${formData.get('aceiteDeclaracao') === 'on' ? 'Sim' : 'Não'}</span></div>
                </div>
            `;
            return content;
        }

        // --- Event Listeners para Mostrar/Esconder Seções ---
        document.addEventListener('DOMContentLoaded', function() {
            const form = document.getElementById('visaForm');

            function toggleVisibility(selectId, targetId, valuesToShow) {
                const selectElement = document.getElementById(selectId);
                const targetElement = document.getElementById(targetId);

                function updateVisibility() {
                    if (valuesToShow.includes(selectElement.value)) {
                        targetElement.style.display = 'block';
                    } else {
                        targetElement.style.display = 'none';
                        // Opcional: Limpar campos quando a seção é escondida
                        Array.from(targetElement.querySelectorAll('input, select, textarea')).forEach(input => {
                            if (input.type === 'checkbox' || input.type === 'radio') {
                                input.checked = false;
                            } else {
                                input.value = '';
                            }
                        });
                    }
                }

                selectElement.addEventListener('change', updateVisibility);
                updateVisibility(); // Call on load to set initial state
            }

            // Pessoal
            toggleVisibility('estadoCivil', 'spouseInfo', ['Casado', 'Divorciado', 'Viúvo', 'União Estável']);
            document.getElementById('estadoCivil').addEventListener('change', function() {
                const spouseDeathInfo = document.getElementById('spouseDeathInfo');
                if (this.value === 'Viúvo') {
                    spouseDeathInfo.style.display = 'block';
                } else {
                    spouseDeathInfo.style.display = 'none';
                    document.getElementById('spouseFalecimento').value = '';
                }
            });
            // Familiar
            toggleVisibility('temPaisVivos', 'parentsInfo', ['Sim']);
            toggleVisibility('paisNosEUA', 'parentsInUSInfo', ['Sim']);
            toggleVisibility('temConhecidosEUA', 'acquaintancesInfo', ['Sim']);
            // Viagem
            toggleVisibility('quemPaga', 'payerInfo', ['Outra pessoa']);
            toggleVisibility('payerSameAddress', 'payerAddressInfo', ['Não']);
            toggleVisibility('temCompanheiros', 'travelCompanionsInfo', ['Sim']);
            // Histórico
            toggleVisibility('primeiroVisto', 'renewalInfo', ['Renovação']);
            toggleVisibility('visitouEUA', 'previousUSVisaInfo', ['Sim']);
            // A seção de detalhes de visto negado/entrada recusada deve ser exibida se *qualquer um* for 'Sim'
            const vistoNegadoSelect = document.getElementById('vistoNegado');
            const entradaRecusadaSelect = document.getElementById('entradaRecusada');
            const visaDeniedDetailsDiv = document.getElementById('visaDeniedDetails');

            function updateVisaDeniedDetailsVisibility() {
                if (vistoNegadoSelect.value === 'Sim' || entradaRecusadaSelect.value === 'Sim') {
                    visaDeniedDetailsDiv.style.display = 'block';
                } else {
                    visaDeniedDetailsDiv.style.display = 'none';
                    document.getElementById('detalhesVistoNegado').value = ''; // Limpa o campo
                }
            }
            vistoNegadoSelect.addEventListener('change', updateVisaDeniedDetailsVisibility);
            entradaRecusadaSelect.addEventListener('change', updateVisaDeniedDetailsVisibility);
            updateVisaDeniedDetailsVisibility(); // Chama ao carregar para o estado inicial
        });

        // --- Função para processar o formulário, gerar PDF e enviar WhatsApp ---
        document.getElementById('btnProcessar').addEventListener('click', async function() {
            const form = document.getElementById('visaForm');
            if (!form.checkValidity()) {
                showMessage('Por favor, preencha todos os campos obrigatórios.', 'error');
                form.reportValidity(); // Mostra as mensagens de erro do navegador
                return;
            }

            this.disabled = true; // Desabilita o botão para evitar múltiplos cliques
            showMessage('Processando... Por favor, aguarde.', 'info');

            const formData = new FormData(form);
            const fileName = `DS160_${formData.get('nome')}_${formData.get('sobrenome')}_${Date.now()}.pdf`;

            try {
                // 1. Gerar o conteúdo HTML para o PDF
                const pdfHtmlContent = generatePdfContent(formData);

                // 2. Gerar o PDF a partir do HTML
                const pdfOptions = {
                    margin: [15, 20, 15, 20], // Top, Left, Bottom, Right em mm
                    filename: fileName,
                    image: { type: 'jpeg', quality: 0.98 },
                    html2canvas: { scale: 2, logging: true, dpi: 192, letterRendering: true },
                    jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
                };

                const pdfBlob = await html2pdf().from(pdfHtmlContent).set(pdfOptions).output('blob');

                // 3. Fazer o upload do PDF para o Firebase Storage
                const storageRef = ref(storage, `formularios/${fileName}`);
                const snapshot = await uploadBytes(storageRef, pdfBlob);
                const downloadURL = await getDownloadURL(snapshot.ref);

                showMessage('PDF gerado e enviado para o armazenamento com sucesso! Preparando mensagem do WhatsApp...', 'success');

                // 4. Preparar e enviar a mensagem do WhatsApp para o número FIXO
                const nomeCompleto = `${formData.get('nome')} ${formData.get('sobrenome')}`;
                const mensagemWhatsApp = encodeURIComponent(
                    `Olá! O formulário de visto americano de ${nomeCompleto} foi preenchido com sucesso e o PDF já está disponível para download. \n\nLink do PDF: ${downloadURL}`
                );

                const whatsappUrl = `https://api.whatsapp.com/send?phone=${whatsappTargetNumber}&text=${mensagemWhatsApp}`;
                
                // Abre o WhatsApp
                window.open(whatsappUrl, '_blank');

                showMessage('PDF gerado, enviado e mensagem do WhatsApp aberta com sucesso!', 'success');

            } catch (error) {
                console.error("Erro completo:", error);
                showMessage(`Ocorreu um erro ao processar o formulário: ${error.message}. Por favor, tente novamente.`, 'error');
            } finally {
                this.disabled = false; // Reabilita o botão
            }
        });
    </script>
</body>
</html>
